---
title: 8. 浏览器相关知识总结
---
[TOC]
## 浏览器
### 1. 浏览器渲染机制
1. 构建DOM树（parse）：渲染引擎解析HTML文档，首先将标签转换成DOM树中的DOM node
2. 构建渲染树（construct）：解析对应的CSS样式文件信息
3. 布局渲染树（reflow/layout）：从根节点递归调用，计算每一个元素的大小、位置等，给出每个节点所应该在屏幕上出现的精确坐标；
4. 绘制渲染树（paint/repaint）：遍历渲染树，使用UI后端层来绘制每个节点。
### 2. 重绘和重排
重绘（repaint或redraw）：当盒子的位置、大小以及其他属性，例如颜色、字体大小等都确定下来之后，浏览器便把这些原色都按照各自的特性绘制一遍，将内容呈现在页面上。重绘是指一个元素外观的改变所触发的浏览器行为，浏览器会根据元素的新属性重新绘制，使元素呈现新的外观。
重绘发生在元素的可见的外观被改变，但并没有影响到布局的时候。比如，仅修改DOM元素的字体颜色（只有Repaint，因为不需要调整布局）

重排（重构/回流/reflow）：当渲染树中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建, 这就称为回流(reflow)。每个页面至少需要一次回流，就是在页面第一次加载的时候。

触发重排的条件：任何页面布局和几何属性的改变都会触发重排：

* 页面渲染初始化(无法避免)
* 添加或删除可见的DOM元素
* 元素位置的改变，或者使用动画
* 元素尺寸的改变——大小，外边距，边框
* 浏览器窗口尺寸的变化
* 填充内容的改变，比如文本的改变或图片大小改变而引起的计算值宽度和高度的改变

重排必定会引发重绘，但重绘不一定会引发重排。
### 3. 浏览器缓存机制
缓存的理解
缓存分为强缓存和协商缓存。强缓存不过服务器，协商缓存需要过服务器，协商缓存返回的状态码是304。两类缓存机制可以同时存在，强缓存的优先级高于协商缓存。当执行强缓存时，如若缓存命中，则直接使用缓存数据库中的数据，不再进行缓存协商。

强缓存
* Expires
* cache-control
协商缓存
* Last-Modified 和 If-Modified-Since
* Etag 和 If-None-Match
### 2. 渲染机制及重绘和回流
### 3. 用户输入url到页面呈现的过程
①浏览器的地址栏输入URL并按下回车。
②浏览器查找当前URL的DNS缓存记录。
③DNS解析URL对应的IP。
④根据IP建立TCP连接（三次握手）。
⑤HTTP发起请求。
⑥服务器处理请求，浏览器接收HTTP响应。
⑦渲染页面，构建DOM树。
⑧关闭TCP连接（四次挥手）。
### 4. 强缓存、协商缓存、CDN缓存
### HTTP2
1. 三次握手与四次挥手
2. 跨域（JSONP/CORS）
3. 跨域时如何处理cookie
4. 垃圾回收机制
## Web安全
### 1. XSS和CSRF区别
跨站脚本攻击（Cross Site Scripting)，为了不和层叠样式表 CSS 混淆，故将跨站脚本攻击缩写为 XSS。恶意攻击者往 Web 页面里插入恶意 Script 代码，当用户浏览该页之时，嵌入其中 Web 里面的 Script 代码会被执行，从而达到恶意攻击用户的目的。

跨站请求伪造（Cross-site request forgery），是伪造请求，冒充用户在站内的正常操作。我们知道，绝大多数网站是通过 cookie 等方式辨识用户身份，再予以授权的。所以要伪造用户的正常操作，最好的方法是通过 XSS 或链接欺骗等途径，让用户在本机（即拥有身份 cookie 的浏览器端）发起用户所不知道的请求。

区别：
* 原理不同，CSRF是利用网站A本身的漏洞，去请求网站A的api；XSS是向目标网站注入JS代码，然后执行JS里的代码。
* CSRF需要用户先登录目标网站获取cookie，而XSS不需要登录
* CSRF的目标是用户，XSS的目标是服务器
* XSS是利用合法用户获取其信息，而CSRF是伪造成合法用户发起请求
### 2. HTTP与HTTPS的区别
* HTTP的URL由http://起始且默认使用端口80，而HTTPS的URL由https://起始且默认使用端口443
* HTTP是超文本传输协议，信息是明文传输，HTTPS则是具有安全性的 SSL 加密传输协议
* HTTP的连接很简单，是无状态的，HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 http 协议安全

1. https
2. 什么是xss，如何预防
3. 什么是csrf，如何预防
4. 为什么会造成csrf攻击
5. 谈谈XSS防御，以及Content-Security-Policy细节
## 前端性能优化
### 1. 谈谈前端性能优化？
①减少HTTP请求：合并文件、CSS精灵、inline Image
②减少DNS查询：DNS查询完成之前浏览器不能从这个主机下载任何任何文件。方法：DNS缓存、将资源分布到恰当数量的主机名，平衡并行下载和DNS查询
③避免重定向：多余的中间访问
④使Ajax可缓存
⑤非必须组件延迟加载和未来所需组件预加载
⑥减少DOM元素数量
⑦将资源放到不同的域下：浏览器同时从一个域下载资源的数目有限，增加域可以提高并行下载量
⑧减少iframe数量

* 使用CDN
* gzip压缩
* 文本压缩
* 合并请求
* 雪碧图
* 图片懒加载
* 缓存资源
* 减少DOM操作
### 2. 首屏加载如何优化
1. 一个网页从请求到呈现花了很长时间，如何排查