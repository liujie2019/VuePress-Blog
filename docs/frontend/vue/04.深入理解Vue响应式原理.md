---
title: 4. æ·±å…¥ç†è§£Vueå“åº”å¼åŸç†
---
::: tip
å†™ä½œä¸æ˜“ï¼ŒStaræ˜¯æœ€å¤§é¼“åŠ±ï¼Œæ„Ÿè§‰å†™çš„ä¸é”™çš„å¯ä»¥ç»™ä¸ªStarâ­ï¼Œè¯·å¤šå¤šæŒ‡æ•™ã€‚[æœ¬åšå®¢çš„Githubåœ°å€](https://github.com/liujie2019/VuePress-Blog)ã€‚
:::
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    Object.defineProperty(target, key, {
        get() {
            return value;
        },
        set(newValue) {
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

// åªæ˜¯ä¸€å±‚
const person = {name: 'kobe'};
observer(person);
person.name = 'james';
console.log(person.name);
```
æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µã€‚
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    // æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œé€’å½’
    observer(value);
    Object.defineProperty(target, key, {
        get() {
            return value;
        },
        set(newValue) {
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

const person = {name: 'kobe', age: {value: 12}};
observer(person);
// person.name = 'james';
person.age.value = 14;
console.log(person.age.value);
```
æ³¨æ„ç‚¹2ï¼šé’ˆå¯¹ç»™keyé‡æ–°èµ‹å€¼çš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µã€‚
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    // æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œé€’å½’
    observer(value);
    Object.defineProperty(target, key, {
        get() {
            return value;
        },
        set(newValue) {
            // æ³¨æ„ç‚¹2ï¼šé’ˆå¯¹ç»™keyé‡æ–°èµ‹å€¼çš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µ
            observer(newValue);
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

const person = {name: 'kobe', age: {value: 12}};
observer(person);
person.age = {value: 13};
person.age.value = 16;
// åº”è¯¥è¾“å‡ºä¸¤æ¬¡'æ•°æ®æ›´æ–°äº†'ï¼Œå› ä¸ºageå’Œvalueéƒ½æ˜¯å“åº”å¼çš„
console.log(person.age.value);
```
![](https://github.com/liujie2019/static_data/blob/master/img/20200105120128.png?raw=true)
## Object.definePropertyçš„ç¼ºé™·
é—®é¢˜ï¼š
1. å¯¹äºå¯¹è±¡æ–°å¢çš„å±æ€§å°†ä¸ä¼šæ˜¯å“åº”å¼çš„
2. ä¸æ”¯æŒå±æ€§å€¼æ˜¯æ•°ç»„çš„æƒ…å†µ
## å®ç°æ•°ç»„åŠ«æŒ
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
const oldArrayPrototype = Array.prototype;
const proto = Object.create(oldArrayPrototype); // ç»§æ‰¿æ•°ç»„åŸå‹çš„æ–¹æ³•
['push', 'shift', 'unshift'].forEach(method => {
    // å‡½æ•°åŠ«æŒï¼ŒæŠŠå‡½æ•°è¿›è¡Œé‡å†™ï¼Œå†…éƒ¨ç»§ç»­è°ƒç”¨è€çš„æ•°ç»„æ–¹æ³•
    proto[method] = function() {
        updateView();// é¢å‘åˆ‡ç‰‡ç¼–ç¨‹
        oldArrayPrototype[method].call(this, ...arguments);
    }
});
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    if (Array.isArray(target)) { // æ‹¦æˆªæ•°ç»„ï¼Œç»™æ•°ç»„çš„æ–¹æ³•è¿›è¡Œäº†é‡å†™
        Object.setPrototypeOf(target, proto);
        // target.__proto__ = proto;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    // æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œé€’å½’
    observer(value);
    Object.defineProperty(target, key, {
        get() { // getä¸­è¿›è¡Œä¾èµ–æ”¶é›†
            return value;
        },
        set(newValue) {
            // æ³¨æ„ç‚¹2ï¼šé’ˆå¯¹ç»™keyé‡æ–°èµ‹å€¼çš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µ
            observer(newValue);
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

const person = {name: 'kobe', hobbies: ['ğŸ€', 'âš½ï¸']};
observer(person);
person.hobbies.push('ğŸ‰'); // éœ€è¦å¯¹æ•°ç»„çš„æ–¹æ³•è¿›è¡Œé‡å†™
```
## å‚è€ƒæ–‡æ¡£
1. [æ·±å…¥ç†è§£Vueå“åº”å¼åŸç†](https://funteas.com/topic/5a809f5847dc830a0e4690c2)