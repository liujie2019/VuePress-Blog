---
title: 4. æ·±å…¥ç†è§£Vueå“åº”å¼åŸç†
---
[TOC]
::: tip
å†™ä½œä¸æ˜“ï¼ŒStaræ˜¯æœ€å¤§é¼“åŠ±ï¼Œæ„Ÿè§‰å†™çš„ä¸é”™çš„å¯ä»¥ç»™ä¸ªStarâ­ï¼Œè¯·å¤šå¤šæŒ‡æ•™ã€‚[æœ¬åšå®¢çš„Githubåœ°å€](https://github.com/liujie2019/VuePress-Blog)ã€‚
:::

## å“åº”å¼ç†è§£
å½“jså¯¹è±¡ä¸­çš„æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œä¸jså¯¹è±¡ä¸­æ•°æ®ç›¸å…³è”çš„DOMè§†å›¾ä¹Ÿä¼šè¿›è¡Œæ›´æ–°(å³æ‰€è°“çš„æ•°æ®é©±åŠ¨è§†å›¾)ã€‚
### æ•°æ®é©±åŠ¨è§†å›¾
Vue.js ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³æ˜¯æ•°æ®é©±åŠ¨ã€‚æ‰€è°“æ•°æ®é©±åŠ¨ï¼Œæ˜¯æŒ‡è§†å›¾æ˜¯ç”±æ•°æ®é©±åŠ¨ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬å¯¹è§†å›¾çš„ä¿®æ”¹ï¼Œä¸ä¼šç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯é€šè¿‡ä¿®æ”¹æ•°æ®ã€‚
## å“åº”å¼å®ç°æ€è·¯
æƒ³è¦å®ç°å“åº”å¼ï¼Œéœ€è¦åšå¦‚ä¸‹äº‹æƒ…ï¼š
1. ç›‘å¬å¯¹è±¡æ•°æ®çš„å˜åŒ–ã€‚
2. æ”¶é›†è§†å›¾ä¾èµ–äº†å“ªäº›æ•°æ®(ä¾èµ–æ”¶é›†)ã€‚
3. æ•°æ®å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é€šçŸ¥å’Œæ•°æ®ç›¸å…³è”çš„è§†å›¾é¡µé¢ï¼Œå¹¶å¯¹è§†å›¾è¿›è¡Œæ›´æ–°ã€‚

1. åˆ©ç”¨Proxyæˆ–Object.definePropertyç”Ÿæˆçš„Observeré’ˆå¯¹å¯¹è±¡/å¯¹è±¡çš„å±æ€§è¿›è¡Œ"åŠ«æŒ"ï¼Œåœ¨å±æ€§å‘ç”Ÿå˜åŒ–åé€šçŸ¥è®¢é˜…è€…ï¼›
2. è§£æå™¨Compilerè§£ææ¨¡æ¿ä¸­çš„Directive(æŒ‡ä»¤)ï¼Œæ”¶é›†æŒ‡ä»¤æ‰€ä¾èµ–çš„æ–¹æ³•å’Œæ•°æ®ï¼Œç­‰å¾…æ•°æ®å˜åŒ–ç„¶åè¿›è¡Œæ¸²æŸ“ï¼›
3. Watcheræ˜¯Observerå’ŒCompileæ¡¥æ¢ï¼Œå®ƒå°†æ¥æ”¶åˆ°çš„Observeräº§ç”Ÿçš„æ•°æ®å˜åŒ–ï¼Œå¹¶æ ¹æ®Compileræä¾›çš„æŒ‡ä»¤è¿›è¡Œè§†å›¾æ¸²æŸ“ï¼Œä½¿å¾—æ•°æ®å˜åŒ–ä¿ƒä½¿è§†å›¾å˜åŒ–ã€‚
### å¦‚ä½•ç›‘å¬å¯¹è±¡æ•°æ®çš„å˜åŒ–ï¼Ÿ
å¯¹è±¡æ•°æ®ç›‘å¬ä¹Ÿå«åš**æ•°æ®åŠ«æŒ**ï¼ŒVueé‡‡ç”¨**æ•°æ®åŠ«æŒåŠ å‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼**ï¼Œé€šè¿‡Object.definePropertyæ¥åŠ«æŒå„ä¸ªå±æ€§çš„setterï¼Œgetterã€‚åœ¨æ•°æ®å˜åŒ–æ—¶å‘é€æ¶ˆæ¯ç»™è®¢é˜…è€…ï¼Œè§¦å‘ç›¸åº”çš„ç›‘å¬å›è°ƒã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ES6ä¸­çš„Proxyæ¥å¯¹å„ä¸ªå±æ€§è¿›è¡Œä»£ç†(æ¨è)ã€‚

å½“æŠŠä¸€ä¸ªæ™®é€šçš„JavaScriptå¯¹è±¡ä¼ å…¥ Vue å®ä¾‹ä½œä¸º data é€‰é¡¹ï¼ŒVue å°†éå†æ­¤å¯¹è±¡æ‰€æœ‰çš„ propertyï¼Œå¹¶ä½¿ç”¨ Object.defineProperty æŠŠè¿™äº› property å…¨éƒ¨è½¬ä¸º getter/setterã€‚**Object.defineProperty æ˜¯ ES5 ä¸­ä¸€ä¸ªæ— æ³• shim çš„ç‰¹æ€§ï¼Œè¿™ä¹Ÿå°±æ˜¯ Vue ä¸æ”¯æŒ IE8 ä»¥åŠæ›´ä½ç‰ˆæœ¬æµè§ˆå™¨çš„åŸå› **ã€‚
[æ·±å…¥å“åº”å¼åŸç†](https://cn.vuejs.org/v2/guide/reactivity.html)
## å“åº”å¼ä»£ç å®ç°
åœ¨ES5ä¸­ï¼Œæ–°å¢äº†Object.definePropertyè¿™ä¸ªAPIï¼Œå…è®¸æˆ‘ä»¬ä¸ºå¯¹è±¡çš„å±æ€§è®¾å®šgetterå’Œsetterã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥APIå¯¹è¯¥å¯¹è±¡çš„å±æ€§å€¼è·å–æˆ–è®¾ç½®è¿›è¡ŒåŠ«æŒã€‚
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
function observer(target) {
    // åˆ¤æ–­targetæ˜¯å¦ä¸ºå¯¹è±¡
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            // å®šä¹‰å“åº”å¼
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    Object.defineProperty(target, key, {
        get() {
            return value;
        },
        set(newValue) {
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

// åªæ˜¯ä¸€å±‚
const person = {name: 'kobe'};
observer(person);
person.name = 'james';
console.log(person.name);
```
æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueä¹Ÿæ˜¯å¯¹è±¡çš„æƒ…å†µ(éœ€è¦é€’å½’è¿›è¡Œç»‘å®š)ã€‚
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    // æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œé€’å½’éå†å­å¯¹è±¡
    observer(value);
    Object.defineProperty(target, key, {
        get() {
            return value;
        },
        set(newValue) {
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

const person = {name: 'kobe', age: {value: 12}};
observer(person);
// person.name = 'james';
person.age.value = 14;
console.log(person.age.value);
```
æ³¨æ„ç‚¹2ï¼šé’ˆå¯¹ç»™key**é‡æ–°èµ‹å€¼**çš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µã€‚
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    // æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œé€’å½’
    observer(value);
    Object.defineProperty(target, key, {
        get() {
            return value;
        },
        set(newValue) {
            // æ³¨æ„ç‚¹2ï¼šé’ˆå¯¹ç»™keyé‡æ–°èµ‹å€¼çš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œå¦‚æœæ–°å€¼æ˜¯å¯¹è±¡çš„è¯ï¼Œé€’å½’è¯¥å¯¹è±¡è¿›è¡Œç›‘å¬
            observer(newValue);
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

const person = {name: 'kobe', age: {value: 12}};
observer(person);
person.age = {value: 13};
person.age.value = 16;
// åº”è¯¥è¾“å‡ºä¸¤æ¬¡'æ•°æ®æ›´æ–°äº†'ï¼Œå› ä¸ºageå’Œvalueéƒ½æ˜¯å“åº”å¼çš„
console.log(person.age.value);
```
![](https://github.com/liujie2019/static_data/blob/master/img/20200105120128.png?raw=true)

## Object.definePropertyçš„ç¼ºé™·
é—®é¢˜ï¼š
1. å¯¹äºå¯¹è±¡æ–°å¢çš„å±æ€§å°†ä¸ä¼šæ˜¯å“åº”å¼çš„
2. ä¸æ”¯æŒå±æ€§å€¼æ˜¯æ•°ç»„çš„æƒ…å†µ
### å®ç°æ•°ç»„åŠ«æŒ
```js
// Vue2.0å¦‚ä½•å®ç°å“åº”å¼åŸç†
// æ•°æ®å˜åŒ–äº†ï¼Œå¯ä»¥æ›´æ–°è§†å›¾
const oldArrayPrototype = Array.prototype;
const proto = Object.create(oldArrayPrototype); // ç»§æ‰¿æ•°ç»„åŸå‹çš„æ–¹æ³•
['push', 'shift', 'unshift'].forEach(method => {
    // å‡½æ•°åŠ«æŒï¼ŒæŠŠå‡½æ•°è¿›è¡Œé‡å†™ï¼Œå†…éƒ¨ç»§ç»­è°ƒç”¨è€çš„æ•°ç»„æ–¹æ³•
    proto[method] = function() {
        updateView(); // é¢å‘åˆ‡ç‰‡ç¼–ç¨‹
        oldArrayPrototype[method].call(this, ...arguments);
    }
});
function observer(target) {
    if (typeof target !== 'object' || target == null) {
        return target;
    }
    if (Array.isArray(target)) { // æ‹¦æˆªæ•°ç»„ï¼Œå°†æ•°ç»„çš„æ–¹æ³•è¿›è¡Œé‡å†™
        Object.setPrototypeOf(target, proto);
        // target.__proto__ = proto;
    }
    for (const key in target) {
        if (target.hasOwnProperty(key)) {
            defineReactive(target, key, target[key]);
        }
    }
}

function defineReactive(target, key, value) {
    // æ³¨æ„ç‚¹1ï¼šé’ˆå¯¹keyçš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œé€’å½’
    observer(value);
    Object.defineProperty(target, key, {
        get() { // getä¸­è¿›è¡Œä¾èµ–æ”¶é›†
            return value;
        },
        set(newValue) {
            // æ³¨æ„ç‚¹2ï¼šé’ˆå¯¹ç»™keyé‡æ–°èµ‹å€¼çš„valueæ˜¯å¯¹è±¡çš„æƒ…å†µ
            observer(newValue);
            if (newValue !== value) {
                updateView();
                value = newValue;
            }
        }
    });
}

function updateView() {
    console.log('æ•°æ®æ›´æ–°äº†');
}

const person = {name: 'kobe', hobbies: ['ğŸ€', 'âš½ï¸']};
observer(person);
person.hobbies.push('ğŸ‰'); // éœ€è¦å¯¹æ•°ç»„çš„æ–¹æ³•è¿›è¡Œé‡å†™
```
### Vueä¸­æ•°ç»„çš„this.$setå®ç°
```js
<body>
    <div id="app-4">
        <ol>
            <li v-for="todo in todos">
            {{ todo.text }}
            </li>
            <li v-for="i in nums">
                {{i}}
            </li>
        </ol>
        <p>{{obj}}</p>
    </div>
    <script>
        var app4 = new Vue({
            el: '#app-4',
            data: {
                todos: [
                    { text: 'å­¦ä¹  JavaScript' },
                    { text: 'å­¦ä¹  Vue' },
                    { text: 'æ•´ä¸ªç‰›é¡¹ç›®' }
                ],
                nums: [1, 2, 3],
                obj: {
                    name: 'lisi'
                }
            },
            mounted() {
                this.add();
                // this.setObj();
            },
            methods: {
                add() {
                    console.log(this.nums);
                    // this.nums[0] = 6; // è¿™æ ·æ”¹çš„è¯ï¼Œæ•°ç»„ä¸­çš„å€¼æ˜¯å‘ç”Ÿå˜åŒ–äº†ï¼Œä½†æ˜¯é¡µé¢å¹¶ä¸ä¼šé‡æ–°æ¸²æŸ“
                    this.$set(this.nums, 0, 6); // éœ€è¦è°ƒç”¨this.$setæ–¹æ³•
                    console.log(this.nums);
                },
                setObj() {
                    // this.obj.age = 12; // è¿™æ ·æ”¹çš„è¯ï¼Œé¡µé¢ä¸ä¼šé‡æ–°æ¸²æŸ“
                    console.log(this.obj);
                    this.$set(this.obj, 'age', 18);
                    console.log(this.obj);
                    this.obj.age = 12;
                }
            }
        });
    </script>
</body>
```
**éœ€è¦æ³¨æ„ï¼šåœ¨Vueä¸­å¯¹æ•°ç»„çš„ä¸‹æ ‡èµ‹å€¼å¤„ç†æ—¶ï¼Œæ˜¯ä¸ä¼šè§¦å‘è§†å›¾çš„æ›´æ–°ï¼Œäºæ˜¯Vueæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼šset**ã€‚

this.$setæ–¹æ³•æœ¬è´¨ä¸Šæ˜¯é€šè¿‡**æ”¹å†™åçš„spliceæ–¹æ³•**æ¥å®ç°çš„ï¼šVueä¸­åªé‡å†™äº†7ä¸ªæ•°ç»„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯pushï¼Œshiftï¼Œunshiftï¼Œpopï¼Œreverseï¼Œsortï¼Œspliceã€‚
```js
if (Array.isArray(target) && isValidArrayIndex(key)) {
    target.length = Math.max(target.length, key)
    target.splice(key, 1, val) // åˆ©ç”¨æ‰©å±•çš„spliceæ–¹æ³•è¿›è¡Œå“åº”å¼
    return val
}
```
```js
// /util/lang.js
export function def (obj: Object, key: string, val: any, enumerable?: boolean) {
  Object.defineProperty(obj, key, {
    value: val,
    enumerable: !!enumerable,
    writable: true,
    configurable: true
  })
}
```
```js
/*
 * not type checking this file because flow doesn't play well with
 * dynamically accessing methods on Array prototype
 */

// defæ–¹æ³•æ˜¯å¯¹Object.definePropertyçš„å°è£…
import {def} from '../util/index'

const arrayProto = Array.prototype
export const arrayMethods = Object.create(arrayProto)

const methodsToPatch = [
  'push',
  'pop',
  'shift',
  'unshift',
  'splice',
  'sort',
  'reverse'
]

/**
 * Intercept mutating methods and emit events
 */
// éå†è¦é‡å†™çš„æ–¹æ³•
methodsToPatch.forEach(function (method) {
  // cache original method
  const original = arrayProto[method] // ç¼“å­˜ä¹‹å‰çš„åŸå‹æ–¹æ³•
  // arrayMethodsæ˜¯æ•°ç»„åŸå‹çš„å‰¯æœ¬
  // å°†æ•°ç»„æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œè¿”å›ç»“æœä¸å˜ï¼Œåªä¸è¿‡åœ¨è¿”å›ç»“æœå‰åšäº†ä¸€äº›äº‹æƒ…
  def(arrayMethods, method, function mutator (...args) {
    const result = original.apply(this, args) // è¿˜æ˜¯è°ƒç”¨åŸç”Ÿæ•°ç»„æ–¹æ³•è¿›è¡Œç»“æœè·å–
    const ob = this.__ob__ // æ˜¯å¦å“åº”å¼çš„æ ‡å¿—ï¼Œä¿å­˜äº†ä¾èµ–æ”¶é›†å¯¹è±¡deps
    let inserted // ä¿å­˜è¦æ’å…¥çš„å‚æ•°å€¼ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„
    switch (method) {
      case 'push':
      case 'unshift': // æ’å…¥æ“ä½œ
        inserted = args // å°†è¦æ’å…¥çš„å‚æ•°èµ‹å€¼ç»™inserted
        break
      case 'splice':
        inserted = args.slice(2) // è·å–åˆ°è¦æ’å…¥çš„å‚æ•°
        break
    }
    if (inserted) ob.observeArray(inserted) // è¿›è¡Œæ•°æ®å“åº”å¼
    // notify change
    ob.dep.notify() // æ‰‹åŠ¨æ›´æ–°å˜åŒ–
    return result
  })
})
```
```js
// observer/index.js
observeArray (items: Array<any>) {
    for (let i = 0, l = items.length; i < l; i++) {
      observe(items[i])
    }
  }
```
```js
export function observe (value: any, asRootData: ?boolean): Observer | void {
  if (!isObject(value) || value instanceof VNode) {
    return
  }
  let ob: Observer | void
  if (hasOwn(value, '__ob__') && value.__ob__ instanceof Observer) {
    ob = value.__ob__
  } else if (
    shouldObserve &&
    !isServerRendering() &&
    (Array.isArray(value) || isPlainObject(value)) &&
    Object.isExtensible(value) &&
    !value._isVue
  ) {
    ob = new Observer(value)
  }
  if (asRootData && ob) {
    ob.vmCount++
  }
  return ob
}
```
æ‰€ä»¥ï¼Œåœ¨Vueä¸­è°ƒç”¨æ•°ç»„çš„pushã€popç­‰æ–¹æ³•æ—¶å…¶å®ä¸æ˜¯ç›´æ¥è°ƒç”¨çš„æ•°ç»„åŸå‹ç»™æˆ‘ä»¬æä¾›çš„pushã€popç­‰æ–¹æ³•ï¼Œè€Œæ˜¯è°ƒç”¨çš„é‡å†™åçš„pushã€popç­‰æ–¹æ³•ã€‚

**Vue.setæ•°ç»„å®ç°çš„åŸç†ï¼šå…¶å®Vue.set()å¯¹äºæ•°ç»„çš„å¤„ç†å…¶å®å°±æ˜¯è°ƒç”¨äº†spliceæ–¹æ³•(è€Œspliceæ˜¯è¢«é‡å†™è¿‡çš„ï¼Œä¼šè§¦å‘è§†å›¾æ›´æ–°)**ã€‚
### å®ç°å¯¹è±¡æ–°å¢å±æ€§åŠ«æŒ(`this.$set`)
Vue æ— æ³•æ£€æµ‹ property çš„æ·»åŠ æˆ–ç§»é™¤ã€‚ç”±äº Vue ä¼šåœ¨åˆå§‹åŒ–å®ä¾‹æ—¶å¯¹ property æ‰§è¡Œ getter/setter è½¬åŒ–ï¼Œæ‰€ä»¥ property å¿…é¡»åœ¨ data å¯¹è±¡ä¸Šå­˜åœ¨æ‰èƒ½è®© Vue å°†å®ƒè½¬æ¢ä¸ºå“åº”å¼çš„ã€‚ä¾‹å¦‚ï¼š
```js
var vm = new Vue({
  data: {
    a: 1
  }
});

// `vm.a` æ˜¯å“åº”å¼çš„

vm.b = 2
// `vm.b` æ˜¯éå“åº”å¼çš„
```
å¯¹äºå·²ç»åˆ›å»ºçš„å®ä¾‹ï¼ŒVue ä¸å…è®¸åŠ¨æ€æ·»åŠ æ ¹çº§åˆ«çš„å“åº”å¼ propertyã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ Vue.set(object, propertyName, value) æ–¹æ³•å‘åµŒå¥—å¯¹è±¡æ·»åŠ å“åº”å¼ propertyã€‚ä¾‹å¦‚ï¼Œå¯¹äºï¼š
```js
Vue.set(vm.someObject, 'b', 2)
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ vm.$set å®ä¾‹æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯å…¨å±€ Vue.set æ–¹æ³•çš„åˆ«åï¼š
```js
this.$set(this.someObject, 'b', 2)
```
[ä»vueæºç çœ‹Vue.set()å’Œthis.$set()](https://www.cnblogs.com/heavenYJJ/p/9559439.html)
### Vue.setå’Œthis.$setå®ç°åŸç†
å…ˆæ¥çœ‹Vue.setçš„æºç ï¼š
```js
import {set} from '../observer/index'

...
Vue.set = set // é™æ€å±æ€§
...
```
å†æ¥çœ‹this.$setçš„æºç ï¼š
```js
import { set } from '../observer/index'

...
Vue.prototype.$set = set // åŸå‹å±æ€§
...
```
å‘ç°Vue.setå’Œthis.$setè¿™ä¸¤ä¸ªapiçš„å®ç°åŸç†æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯ä½¿ç”¨äº†setå‡½æ•°ã€‚setå‡½æ•°æ˜¯ä»`../observer/index`æ–‡ä»¶ä¸­å¯¼å‡ºçš„ï¼ŒåŒºåˆ«åœ¨äºVue.set()æ˜¯å°†setå‡½æ•°ç»‘å®šåœ¨Vueæ„é€ å‡½æ•°ä¸Šï¼Œthis.$set()æ˜¯å°†setå‡½æ•°ç»‘å®šåœ¨VueåŸå‹ä¸Šã€‚

æ¥ä¸‹æ¥çœ‹ä¸‹`../observer/index`ä¸­å¯¼å‡ºçš„setå‡½æ•°ï¼š
```js
export function set (target: Array<any> | Object, key: any, val: any): any {
  if (process.env.NODE_ENV !== 'production' &&
    (isUndef(target) || isPrimitive(target))
  ) {
    warn(`Cannot set reactive property on undefined, null, or primitive value: ${(target: any)}`)
  }
  if (Array.isArray(target) && isValidArrayIndex(key)) {
    target.length = Math.max(target.length, key)
    target.splice(key, 1, val)
    return val
  }
  // å…ˆåˆ¤æ–­å¦‚æœkeyæœ¬æ¥å°±æ˜¯å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå¹¶ä¸”keyä¸æ˜¯ObjectåŸå‹ä¸Šçš„å±æ€§ã€‚è¯´æ˜è¿™ä¸ªkeyæœ¬æ¥å°±åœ¨å¯¹è±¡ä¸Šé¢å·²ç»å®šä¹‰è¿‡äº†çš„ï¼Œç›´æ¥ä¿®æ”¹å€¼å°±å¯ä»¥äº†ï¼Œå¯ä»¥è‡ªåŠ¨è§¦å‘é¡µé¢åˆ·æ–°
  if (key in target && !(key in Object.prototype)) {
    target[key] = val
    return val
  }
  const ob = (target: any).__ob__
  if (target._isVue || (ob && ob.vmCount)) {
    process.env.NODE_ENV !== 'production' && warn(
      'Avoid adding reactive properties to a Vue instance or its root $data ' +
      'at runtime - declare it upfront in the data option.'
    )
    return val
  }
  if (!ob) {
    target[key] = val
    return val
  }
  // ç»™æ–°çš„å±æ€§å®šä¹‰å“åº”å¼ï¼Œä»¥åä¿®æ”¹æ–°çš„å±æ€§å€¼ä¹Ÿä¼šè§¦å‘è§†å›¾æ›´æ–°
  defineReactive(ob.value, key, val)
  ob.dep.notify()
  return val
}
```
## ä½¿ç”¨Proxyæ¥å®ç°æ•°æ®åŠ«æŒ
Object.definePropertyæ–¹æ³•å­˜åœ¨å¦‚ä¸‹ç¼ºç‚¹ï¼š
1. ç›‘å¬æ•°ç»„çš„æ–¹æ³•ä¸èƒ½è§¦å‘Object.definePropertyæ–¹æ³•ä¸­setæ“ä½œ(å¦‚æœæˆ‘ä»¬éœ€è¦ç›‘å¬çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™æ•°ç»„çš„æ–¹æ³•)ã€‚
2. å¿…é¡»éå†æ¯ä¸ªå¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼Œå¦‚æœå¯¹è±¡åµŒå¥—æ¯”è¾ƒæ·±çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦é€’å½’è°ƒç”¨ã€‚


## å‚è€ƒæ–‡æ¡£
1. [æ·±å…¥ç†è§£Vueå“åº”å¼åŸç†](https://funteas.com/topic/5a809f5847dc830a0e4690c2)
2. [vueç³»åˆ—---å“åº”å¼åŸç†å®ç°åŠObserveræºç è§£æ(ä¸ƒ)](https://www.cnblogs.com/tugenhua0707/p/11754291.html)
3. [æ·±å…¥ç†è§£ Object.defineProperty åŠå®ç°æ•°æ®åŒå‘ç»‘å®š](https://www.cnblogs.com/tugenhua0707/p/10261170.html)
4. [Vue çš„æ•°æ®å“åº”å¼åŸç†](https://www.infoq.cn/article/we3l33H5zGYyg6gC9hRi)