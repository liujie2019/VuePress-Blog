---
title: 3. è‡ªåŠ¨ç”ŸæˆHTMLæ–‡ä»¶
---
## æ’ä»¶å®‰è£…å’Œé…ç½®
ç¬¬ä¸€æ­¥ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®‰è£…æ’ä»¶ï¼š
```bash
yarn add html-webpack-plugin -D
```
`html-webpack-plugin`ä¼šåœ¨é¡¹ç›®æ‰“åŒ…ç»“æŸåï¼Œåœ¨æ‰“åŒ…ç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªhtmlæ–‡ä»¶(ä¸ªæ•°ç”±å…¥å£æ–‡ä»¶çš„ä¸ªæ•°å†³å®š)ï¼Œå¹¶æŠŠæ‰“åŒ…ç”Ÿæˆçš„jsæˆ–è€…cssæ–‡ä»¶è‡ªåŠ¨å¼•å…¥åˆ°å¯¹åº”çš„htmlæ–‡ä»¶ä¸­ã€‚å¦å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘æ’ä»¶ä¼ é€’å‚æ•°ï¼Œæ¥æ§åˆ¶HTMLæ–‡ä»¶çš„è¾“å‡ºã€‚

ç¬¬äºŒæ­¥ï¼šåœ¨webpacké…ç½®æ–‡ä»¶ä¸­å¼•å…¥è¯¥æ’ä»¶ï¼š
```js
const htmlWebpackPlugin = require('html-webpack-plugin');
```
ç¬¬ä¸‰æ­¥ï¼šåœ¨webpacké…ç½®æ–‡ä»¶æš´éœ²çš„å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªpluginså±æ€§ï¼Œè¯¥å±æ€§å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå°†æ–°å»ºçš„html-webpack-pluginå¯¹è±¡å®ä¾‹æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚è‹¥ä¸ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆæ’ä»¶å°†ç”Ÿæˆé»˜è®¤çš„htmlæ–‡ä»¶ã€‚
```js
module.exports = {
    entry: {
        main:'./src/index.js'
    },
    output: {
        path: './dist',
        filename: '[name].bundle.js'
    },
    plugins:[
        new htmlWebpackPlugin()
    ]
}
```
ç¬¬å››æ­¥ï¼šé…ç½®å‚æ•°ï¼Œä¸ºæ–°å»ºçš„å¯¹è±¡å®ä¾‹ä¼ å…¥ä¸€ä¸ªå¯¹è±¡å­—é¢é‡å‚æ•°ï¼Œåˆå§‹åŒ–å¯¹è±¡å®ä¾‹çš„å±æ€§ã€‚
```js
module.exports = {
    plugins:[
        new htmlWebpackPlugin({
            filename: 'index.html',
            template: './src/index.html',
            inject: false,
            title: 'htmlæ¨¡æ¿',
            // åŒ…å«çš„chunk
            chunks: ['main']
        })
   ]
}
```
### htmlWebpackPluginå¯¹è±¡
htmlWebpackPluginå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯filesï¼Œä¸€ä¸ªæ˜¯optionsã€‚è¿™ä¸¤ä¸ªå±æ€§çš„å€¼éƒ½æ˜¯å¯¹è±¡ã€‚é€šè¿‡ejsè¯­æ³•ï¼Œå¯ä»¥åœ¨htmlæ¨¡æ¿æ–‡ä»¶ä¸­éå†è¿™ä¸¤ä¸ªå±æ€§ï¼š
```html
<% for(var key in htmlWebpackPlugin.files) { %>
    <%= key %> : <%= JSON.stringify(htmlWebpackPlugin.files[key]) %> //å°†å¯¹è±¡æˆ–æ•°ç»„è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ã€‚
<% } %>

<% for(var key in htmlWebpackPlugin.options) { %>
    <%= key %> : <%= JSON.stringify(htmlWebpackPlugin.options[key]) %>
<% } %>
```
éå†ç»“æœå¦‚ä¸‹ï¼š
<img :src="$withBase('/webpack4/html-webpack-plugin.png')" alt="">

### å‚æ•°è¯´æ˜
* title: æŒ‡å®šç”Ÿæˆé¡µé¢çš„titleï¼›
* filename: ç”Ÿæˆçš„htmlæ–‡ä»¶çš„æ–‡ä»¶åã€‚é»˜è®¤index.htmlï¼Œå¯ä»¥ç›´æ¥é…ç½®å¸¦æœ‰å­ç›®å½•ï¼›
* template: æŒ‡å®šç”Ÿæˆçš„htmlæ–‡ä»¶æ‰€ä¾èµ–çš„æ¨¡æ¿æ–‡ä»¶ï¼Œæ¨¡æ¿ç±»å‹å¯ä»¥æ˜¯htmlã€jadeã€ejsç­‰ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå®šä¹‰çš„æ¨¡æ¿æ–‡ä»¶æ—¶ï¼Œéœ€è¦å®‰è£…å¯¹åº”çš„loaderã€‚

ä¸¾ä¸ªğŸŒ°ï¼š
```js
yarn add ejs-loader -D
```
```js
loaders: {
    ...
    {
        test: /\.ejs$/,
        loader: 'ejs-loader'
    }
}
plugins: [
    new HtmlWebpackPlugin({
        ...
        ejs: 'path/to/yourfile.ejs'
    })
]
```
* inject: æ·»åŠ æ‰€æœ‰çš„é™æ€èµ„æºæ–‡ä»¶åˆ°æ¨¡æ¿æ–‡ä»¶ï¼Œæœ‰ä»¥ä¸‹å››ä¸ªå€¼ï¼š
    * trueï¼šé»˜è®¤å€¼ï¼Œæ‰€æœ‰æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶éƒ½æ’å…¥åˆ°htmlæ–‡ä»¶çš„bodyåº•éƒ¨ï¼›
    * bodyï¼šæ•ˆæœä¸trueç›¸åŒï¼Œæ‰€æœ‰æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶éƒ½æ’å…¥åˆ°htmlæ–‡ä»¶çš„bodyåº•éƒ¨ï¼›
    * headï¼šæ‰€æœ‰æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶éƒ½æ’å…¥åˆ°htmlæ–‡ä»¶çš„headæ ‡ç­¾ä¸­ï¼›
    * false(ç”¨ä¸åˆ°)ï¼šæ‰€æœ‰æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶éƒ½ä¸ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°HTMLæ¨¡æ¿æ–‡ä»¶ä¸­ã€‚
* favicon: ç»™ç”Ÿæˆçš„htmlæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªfaviconï¼Œå€¼æ˜¯ä¸€ä¸ªè·¯å¾„ï¼š
```js
plugins: [
    new HtmlWebpackPlugin({
        favicon: 'path/to/favicon.ico'
    })
```
ç„¶ååœ¨ç”Ÿæˆçš„htmlä¸­å°±ä¼šç”Ÿæˆå¯¹åº”çš„linkæ ‡ç­¾ï¼š
```html
<link rel="shortcut icon" href=favicon.ico>
```

* minify: ä½¿ç”¨è¯¥å±æ€§ä¼šå¯¹ç”Ÿæˆçš„htmlæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œé»˜è®¤æ˜¯falseã€‚html-webpack-pluginå†…éƒ¨é›†æˆäº†html-minifierã€‚å› æ­¤ï¼Œè¿˜å¯ä»¥å¯¹minifyè¿›è¡Œé…ç½®ã€‚æ³¨æ„ï¼Œè™½ç„¶minifyæ”¯æŒBooleanObjectï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è¿™æ ·å†™ï¼šminify: trueï¼Œè¿™æ ·ä¼šæŠ¥é”™`ERROR in TypeError: Cannot use 'in' operator to search for 'html5' in true`ï¼Œä½¿ç”¨æ—¶å€™å¿…é¡»ç»™å®šä¸€ä¸ª`{}`å¯¹è±¡ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š
```js
plugins: [
    new HtmlWebpackPlugin({
        ...,
        minify: {
            removeAttributeQuotes: true, // ç§»é™¤å±æ€§çš„å¼•å·
            collapseWhitespace: true // æŠ˜å ç©ºè¡Œå˜æˆä¸€è¡Œ
        }
    })
]
```
* hash: é»˜è®¤å€¼ä¸ºfalseï¼Œå¦‚æœå€¼ä¸ºtrueï¼Œå°±æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„webpack compilation hash(æœ¬æ¬¡webpackç¼–è¯‘çš„hashå€¼)ç»™æ‰€æœ‰å·²ç»æ·»åŠ çš„`jsè„šæœ¬å’ŒCSS`æ–‡ä»¶ï¼Œè¿™å¯¹**æ¸…é™¤ç¼“å­˜**ååˆ†æœ‰ç”¨ã€‚
* cache: é»˜è®¤å€¼æ˜¯trueï¼Œè¡¨ç¤ºå†…å®¹å˜åŒ–çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚
* showErrors: é»˜è®¤å€¼ä¸ºtrueï¼Œå½“webpackæŠ¥é”™çš„æ—¶å€™ï¼Œè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å°†è¢«åŒ…è£¹åœ¨ä¸€ä¸ªpreä¸­è¾“å…¥åˆ°HTMLé¡µé¢ä¸­ã€‚
* chunks: å…è®¸æˆ‘ä»¬åªå¯¹é¡µé¢æ·»åŠ éƒ¨åˆ†chunksï¼Œä¸»è¦ç”¨äºå¤šå…¥å£æ–‡ä»¶çš„æƒ…å†µã€‚å½“æœ‰å¤šä¸ªå…¥å£æ–‡ä»¶æ—¶ï¼Œæ‰“åŒ…åå°±ä¼šç”Ÿæˆå¤šä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆchunksé¡¹ç”¨äºè®¾ç½®æƒ³è¦ä½¿ç”¨çš„jsæ–‡ä»¶ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š

```js
entry: {
    index: path.resolve(__dirname, './src/index.js'),
    vender: path.resolve(__dirname, './src/vender.js'),
    main: path.resolve(__dirname, './src/main.js')
}

plugins: [
    new htmlWebpackPlugin({
        chunks: ['index', 'vender']
    })
]
```
é‚£ä¹ˆç¼–è¯‘æ‰“åŒ…åå°†åªåŒ…å«å¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š
```html
<script type=text/javascript src="index.js"></script>
<script type=text/javascript src="vender.js"></script>
```
å¦‚æœæ²¡æœ‰è®¾ç½®chunksé€‰é¡¹ï¼Œé‚£ä¹ˆé»˜è®¤æ˜¯å…¨éƒ¨åŒ…å«ã€‚

* excludeChunks: æ’é™¤æ‰ä¸éœ€è¦çš„jsè„šæœ¬(ä¸chunkså±æ€§æ­£å¥½ç›¸å)ã€‚
```js
// ç­‰ä»·äºä¸Šé¢çš„é…ç½®
excludeChunks: ['main.js']
```
* chunksSortMode: åœ¨chunksè¢«åŠ å…¥åˆ°htmlæ–‡ä»¶å‰ï¼Œå…è®¸æ§åˆ¶chunksåº”å½“å¦‚ä½•è¢«æ’åºã€‚å€¼å¯ä»¥ä¸ºï¼š`'none'ï¼Œ'manual'ï¼Œ'auto'ï¼Œ'dependency'ï¼Œ{function}`ï¼Œé»˜è®¤å€¼: `'auto'`ã€‚
    * dependencyï¼šæŒ‰ç…§ä¸åŒæ–‡ä»¶çš„ä¾èµ–å…³ç³»æ¥æ’åºï¼›
    * autoï¼šé»˜è®¤å€¼ï¼Œæ’ä»¶çš„å†…ç½®çš„æ’åºæ–¹å¼ï¼›
    * noneï¼šæ— åºï¼›
    * manual: chunksæŒ‰å¼•å…¥çš„é¡ºåºæ’åº, å³å±æ€§chunksçš„é¡ºåºï¼›
    * {function}ï¼šè‡ªå®šä¹‰æŒ‡å®šå…·ä½“çš„æ’åºè§„åˆ™ã€‚
* xhtml: é»˜è®¤å€¼æ˜¯falseï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™ä»¥å…¼å®¹xhtmlçš„æ¨¡å¼å¼•ç”¨æ–‡ä»¶ã€‚

### ç‰¹æ®Šæƒ…å†µï¼šä½¿ç”¨ejsè¯­æ³•å‘HTMLæ¨¡æ¿æ–‡ä»¶æ‰‹åŠ¨æ·»åŠ æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶
::: tip
1. ç”±äºinjectå‚æ•°ä¸èƒ½è¢«åŒæ—¶è®¾ç½®ä¸ºheadå’Œbodyï¼Œå› æ­¤ï¼Œå½“æœ‰çš„æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶éœ€è¦è¢«æ·»åŠ åˆ°headæ ‡ç­¾ï¼Œè€Œå¦å¤–çš„éœ€è¦è¢«æ·»åŠ åˆ°bodyæ ‡ç­¾ä¸­æ—¶ï¼Œå°±éœ€è¦æ‰‹åŠ¨å‘HTMLæ¨¡æ¿æ³¨å…¥è„šæœ¬ã€‚
:::
```html
<head>
    <script src="<%= htmlWebpackPlugin.files.chunks.main.entry %>"></script>
</head>
<body>
<% for(let k in htmlWebpackPlugin.files.chunks){ %>
    <% if(k!=='main'){ %>
    <script src="<%= htmlWebpackPlugin.files.chunks[k].entry %>"></script>
    <% } %>
<% } %>
</body>
```
::: tip
2. ä¸ºäº†ç½‘é¡µçš„åŠ è½½æ€§èƒ½ï¼Œå‡å°‘HTTPè¯·æ±‚ï¼Œå½“æœ‰çš„æ‰“åŒ…åçš„è„šæœ¬æ–‡ä»¶éœ€è¦è¢«å†…åµŒåˆ°headæ ‡ç­¾ä¸­ï¼Œè€Œå…¶ä½™çš„éœ€è¦ä»¥å¤–éƒ¨èµ„æºçš„æ–¹å¼æ·»åŠ åˆ°HTMLæ¨¡æ¿ä¸­æ—¶ï¼Œä¹Ÿéœ€è¦æ‰‹åŠ¨å‘HTMLæ¨¡æ¿æ³¨å…¥è„šæœ¬ã€‚
:::
```html
<head>
    ...
    <script type="text/javascript" src="<%= compilation.assets[htmlWebpackPlugin.files.chunks.main.entry.substr(htmlWebpackPlugin.files.publicPath.length)].source() %>"></script>
</head>

<body>
<% for(var k in htmlWebpackPlugin.files.chunks){ %>
    <% if(k!=='main'){ %>
    <script src="<%= htmlWebpackPlugin.files.chunks[k].entry %>"></script>
    <% } %>
<% } %>
</body>
```
## å¤šé¡µé¢åº”ç”¨(MPA)æ‰“åŒ…(ç”Ÿæˆå¤šä¸ªHTMLæ–‡ä»¶)
æ¦‚å¿µç†è§£ï¼šæ¯ä¸€æ¬¡é¡µé¢è·³è½¬çš„æ—¶å€™ï¼Œåå°æœåŠ¡å™¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„htmlæ–‡æ¡£ï¼Œè¿™ç§ç±»å‹çš„ç½‘ç«™ä¹Ÿå°±æ˜¯å¤šé¡µé¢ç½‘ç«™ï¼Œä¹Ÿå«ä½œå¤šé¡µé¢åº”ç”¨ã€‚

å¤šé¡µé¢åº”ç”¨ä¼˜åŠ¿ï¼š
* å„ä¸ªé¡µé¢ä¹‹é—´æ˜¯è§£è€¦çš„ï¼›
* å¯¹SEOæ›´åŠ å‹å¥½ã€‚

å½“å¼€å‘ä¸€ä¸ªå¤šé¡µé¢åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸ºä¸åŒçš„é¡µé¢ç”Ÿæˆä¸åŒçš„HTMLæ–‡ä»¶ï¼Œé€šè¿‡å‘pluginsæ•°ç»„æ·»åŠ å¤šä¸ªæ’ä»¶å®ä¾‹å°±å¯ä»¥å®ç°ã€‚æ‰€ä»¥å¤šé¡µé¢åº”ç”¨æ‰“åŒ…çš„åŸºæœ¬æ€è·¯æ˜¯ï¼šæ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªentryå’Œä¸€ä¸ª`HtmlWebpackPlugin`ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šæ¯æ¬¡æ–°å¢æˆ–è€…åˆ é™¤é¡µé¢éƒ½éœ€è¦æ›´æ”¹webpacké…ç½®ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š
```js
module.exports = {
  entry: {
      index: './src/index.js',
      sub: './src/sub.js'
  },
  output: {
    path: './dist',
    filename: '[name].bundle.js'
  },
  plugins: [
    new HtmlWebpackPlugin({
        filename: 'index.html',
        template: './src/index.html',
         chunks: ['index'] // åªå¼•å…¥æ‰“åŒ…åçš„index.js
    }), // ç”Ÿæˆindex.html
    new HtmlWebpackPlugin({  // ç”Ÿæˆsub.html
         filename: 'sub.html',
         template: './src/index.html',
         chunks: ['sub'] // åªå¼•å…¥æ‰“åŒ…åçš„sub.js
    })
  ]
}
```
### å¤šé¡µé¢åº”ç”¨æ‰“åŒ…é€šç”¨æ–¹æ¡ˆ
åŸºæœ¬æ€è·¯ï¼šåŠ¨æ€è·å–entryå’Œè®¾ç½®`html-webpack-plugin`æ•°é‡ã€‚éœ€è¦ç”¨åˆ°`glob.sync`ã€‚

éœ€è¦æ³¨æ„ï¼šè¿™ç§æ–¹å¼çš„å‰ææ˜¯æ‰€æœ‰å…¥å£æ–‡ä»¶éƒ½å¿…é¡»æ”¾åœ¨å•ç‹¬çš„ç›®å½•ä¸‹ï¼Œå…¥å£æ–‡ä»¶åä¸ºindex.jsï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šsearché¡µé¢çš„å…¥å£ä¸º`search/index.js`ã€‚
```bash
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ index
â”‚   â”‚   â”œâ”€â”€ helloworld.js
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ search
â”‚       â”œâ”€â”€ images
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ index.js
â”‚       â”œâ”€â”€ meta.html
â”‚       â””â”€â”€ search.less
â”œâ”€â”€ webpack.config.js
```
```js
yarn add glob -D
```
```js
const setMPA = () => {
    const entry = {};
    const htmlWebpackPlugins = [];
    const entryFiles = glob.sync(path.join(__dirname, './src/*/index.js'));
    // console.log(entryFiles); // å…¥å£æ–‡ä»¶æ•°ç»„
    entryFiles.map(entryFile => {
        // æ­£åˆ™åŒ¹é…ä»¥srcå¼€å¤´
        const match = entryFile.match(/src\/(.*)\/index\.js/);
        // console.log(match);
        const pathName = match && match[1];
        entry[pathName] = entryFile;
        htmlWebpackPlugins.push(
            new HtmlWebpackPlugin({
                inlineSource: '.css$',
                template: path.join(__dirname, `src/${pathName}/index.html`),
                filename: `${pathName}.html`,
                chunks: [pathName],
                inject: true,
                minify: {
                    html5: true,
                    collapseWhitespace: true,
                    preserveLineBreaks: false,
                    minifyCSS: true,
                    minifyJS: true,
                    removeComments: false
                }
            })
        );
    });
    return {
        entry,
        htmlWebpackPlugins
    };
}
```
## å‘ç‚¹æ±‡æ€»
```js
// ä¸ç”Ÿæ•ˆ
<%= htmlWebpackPlugin.options.title %>
```
æ˜¯å› ä¸ºwebpack.config.jsçš„é…ç½®æ–‡ä»¶é‡Œé¢åŠ äº†html-loaderï¼ŒåŠ äº†ä¹‹åä¼šæ­£å¸¸è§£æhtmlæ–‡ä»¶ä½œä¸ºæ¨¡ç‰ˆï¼Œå°±ä¼šç›´æ¥æŠŠ`<%= htmlWebpackPlugin.options.title %>`è§£ææˆå­—ç¬¦ä¸²ã€‚å¦‚æœæœ‰html-loaderï¼Œå»æ‰å°±å¯ä»¥äº†ã€‚

## å‚è€ƒæ–‡æ¡£
1. [html-webpack-plugin](https://www.jianshu.com/p/2c849a445a91)
2. [æ’ä»¶ html-webpack-plugin çš„è¯¦è§£](https://segmentfault.com/a/1190000013883242)
3. [html-webpack-pluginç”¨æ³•æ€»ç»“](https://segmentfault.com/a/1190000016403039)