---
title: 8. Generator(ç”Ÿæˆå™¨)
---
## ä»€ä¹ˆæ˜¯Generatorå‡½æ•°
1. ES6æä¾›çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚
2. Generatorå‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå†…éƒ¨å°è£…äº†ä¸åŒçŠ¶æ€çš„æ•°æ®ã€‚
3. ç”¨æ¥ç”Ÿæˆéå†å™¨å¯¹è±¡(iteratoræ¥å£)ï¼Œè°ƒç”¨Generatorå‡½æ•°å¹¶ä¸ä¼šæ‰§è¡Œå…¶å†…éƒ¨çš„ä»£ç ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚
4. å¯ä»¥æš‚åœå‡½æ•°(æƒ°æ€§æ±‚å€¼)ï¼Œyieldå¯æš‚åœï¼Œnextæ–¹æ³•å¯ç»§ç»­æ‰§è¡Œï¼Œæ¯æ¬¡è¿”å›çš„æ˜¯yieldåé¢è¡¨è¾¾å¼çš„ç»“æœã€‚

### Generatorå‡½æ•°ç‰¹ç‚¹
1. functionå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ª`*`æ˜Ÿå·ã€‚
2. å†…éƒ¨ç”¨yieldè¡¨è¾¾å¼æ¥å®šä¹‰ä¸åŒçš„çŠ¶æ€ã€‚
3. è°ƒç”¨Generatorå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œè€Œä¸ä¼šæ‰§è¡Œå‡½æ•°å†…éƒ¨é€»è¾‘ã€‚
4. è°ƒç”¨nextæ–¹æ³•ï¼Œå‡½æ•°å†…éƒ¨é€»è¾‘å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ°yieldè¡¨è¾¾å¼åœæ­¢å‘ä¸‹æ‰§è¡Œï¼Œè¿”å›{value: yieldåçš„è¡¨è¾¾å¼ç»“æœ/undefined, done: false/true}ã€‚å¦‚æœGeneratorå‡½æ•°æœ‰returnè¯­å¥ï¼Œæœ€åè¿”å›{value: returnçš„ç»“æœ(é»˜è®¤æ˜¯undefined), done: true}ã€‚
5. å†æ¬¡è°ƒç”¨nextæ–¹æ³•ä¼šä»ä¸Šä¸€æ¬¡åœæ­¢æ—¶çš„yieldè¡¨è¾¾å¼å¤„å¼€å§‹ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼åœæ­¢æˆ–è€…æœ€åã€‚
6. yieldè¯­å¥è¿”å›ç»“æœé€šå¸¸æ˜¯undefinedï¼Œ**å½“è°ƒç”¨nextæ–¹æ³•æ—¶ä¼ å‚å†…å®¹ä¼šä½œä¸ºå¯åŠ¨æ—¶yieldè¯­å¥çš„è¿”å›å€¼**ã€‚

æ¥çœ‹ä¸ªğŸŒ°ï¼š
```js
function* generatorExample() {
    console.log('å‡½æ•°å¼€å§‹æ‰§è¡Œ');
    let res = yield 'hello'; // yieldè¯­å¥è¿”å›ç»“æœé»˜è®¤æ˜¯ä¸ºundefined
    console.log(res); // 'æˆ‘æ˜¯nextä¼ å…¥çš„å€¼'
    console.log('å‡½æ•°ç»§ç»­æ‰§è¡Œ');
    yield 'world';
    // å‡½æ•°æ²¡æœ‰returnè¯­å¥çš„è¯ï¼Œé»˜è®¤è¿”å›undefined
    return 'æ‰§è¡Œç»“æŸ';
}

const gen = generatorExample();
console.log(gen.next());
// å½“è°ƒç”¨nextæ–¹æ³•æ—¶ä¼ å‚å†…å®¹ä¼šä½œä¸ºå¯åŠ¨æ—¶yieldè¯­å¥çš„è¿”å›å€¼
console.log(gen.next('æˆ‘æ˜¯nextä¼ å…¥çš„å€¼'));
console.log(gen.next());
```
ç»“æœå¦‚ä¸‹ï¼š
```js
å‡½æ•°å¼€å§‹æ‰§è¡Œ
{value: "hello", done: false}
æˆ‘æ˜¯nextä¼ å…¥çš„å€¼
å‡½æ•°ç»§ç»­æ‰§è¡Œ
{value: "world", done: false}
{value: "æ‰§è¡Œç»“æŸ", done: true} // å‡½æ•°æ²¡æœ‰returnè¯­å¥çš„è¯å°†è¿”å›{value: undefined, done: true}
```
### Generatorå‡½æ•°åŸºæœ¬è¯­æ³•
Generatorå‡½æ•°è¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚
```js
// è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼šä¸¤ä¸ªyieldè¡¨è¾¾å¼(helloï¼Œworld)å’Œreturnè¯­å¥
function* testGenerator() {
    yield 'hello';
    yield 'world';
    return 'end';
}
// è°ƒç”¨Generatorå‡½æ•°åï¼Œè¯¥å‡½æ•°å¹¶ä¸æ‰§è¡Œï¼Œè¿”å›çš„ä¹Ÿä¸æ˜¯å‡½æ•°è¿è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œå³éå†å™¨å¯¹è±¡
const gen = testGenerator();
```
ä¸Šé¢ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ª`Generator`å‡½æ•°testGeneratorï¼Œå®ƒå†…éƒ¨æœ‰ä¸¤ä¸ªyieldè¡¨è¾¾å¼ï¼Œå³**è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªçŠ¶æ€ï¼šhelloï¼Œworldå’Œreturnè¯­å¥(ç»“æŸæ‰§è¡Œ)**ã€‚
å½¢å¼ä¸Šï¼Œ`Generator`å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ï¼š
1. functionå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›
2. å‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨yield(ç¿»è¯‘ä¸ºäº§å‡º)è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼›

`Generator`å‡½æ•°çš„è°ƒç”¨æ–¹æ³•ä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨å‡½æ•°ååé¢åŠ ä¸Šä¸€å¯¹åœ†æ‹¬å·ã€‚åŒºåˆ«åœ¨äºï¼š**è°ƒç”¨Generatorå‡½æ•°åï¼Œè¯¥å‡½æ•°å¹¶ä¸æ‰§è¡Œï¼Œè¿”å›çš„ä¹Ÿä¸æ˜¯å‡½æ•°è¿è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œå³éå†å™¨å¯¹è±¡(Iterator Object)**ã€‚

å¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œä½¿å¾—æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼(æˆ–returnè¯­å¥)ä¸ºæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**Generatorå‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„**ï¼Œyieldè¡¨è¾¾å¼æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œnextæ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚
```js
gen.next();
// valueå€¼æ˜¯yieldåçš„è¡¨è¾¾å¼ç»“æœ
// { value: 'hello', done: false }
gen.next();
// { value: 'world', done: false }
gen.next();
// { value: 'end', done: true }
gen.next();
// { value: undefined, done: true }
```
ä¸Šé¢ä»£ç ä¸€å…±è°ƒç”¨äº†å››æ¬¡nextæ–¹æ³•ã€‚
* ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šGeneratorå‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªyieldè¡¨è¾¾å¼ä¸ºæ­¢ã€‚nextæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„valueå±æ€§æ˜¯å½“å‰yieldè¡¨è¾¾å¼çš„å€¼helloï¼Œdoneå±æ€§çš„å€¼falseï¼Œè¡¨ç¤ºéå†è¿˜æ²¡æœ‰ç»“æŸã€‚
* ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šGeneratorå‡½æ•°ä»ä¸Šæ¬¡yieldè¡¨è¾¾å¼åœä¸‹çš„åœ°æ–¹ï¼Œä¸€ç›´æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼ã€‚nextæ–¹æ³•è¿”å›çš„å¯¹è±¡çš„valueå±æ€§å°±æ˜¯å½“å‰yieldè¡¨è¾¾å¼çš„å€¼worldï¼Œdoneå±æ€§çš„å€¼falseï¼Œè¡¨ç¤ºéå†è¿˜æ²¡æœ‰ç»“æŸã€‚
* ç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼šGeneratorå‡½æ•°ä»ä¸Šæ¬¡yieldè¡¨è¾¾å¼åœä¸‹çš„åœ°æ–¹ï¼Œä¸€ç›´æ‰§è¡Œåˆ°returnè¯­å¥(å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå°±æ‰§è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œå…¶å®æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªéšå¼çš„returnè¯­å¥ï¼Œé»˜è®¤è¿”å›undefined)ã€‚nextæ–¹æ³•è¿”å›çš„å¯¹è±¡çš„valueå±æ€§ï¼Œå°±æ˜¯ç´§è·Ÿåœ¨returnè¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼ˆå¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œåˆ™valueå±æ€§çš„å€¼ä¸ºundefined)ï¼Œdoneå±æ€§çš„å€¼trueï¼Œè¡¨ç¤ºéå†å·²ç»ç»“æŸã€‚
* ç¬¬å››æ¬¡è°ƒç”¨ï¼šæ­¤æ—¶Generatorå‡½æ•°å·²ç»è¿è¡Œå®Œæ¯•ï¼Œnextæ–¹æ³•è¿”å›å¯¹è±¡çš„valueå±æ€§ä¸ºundefinedï¼Œdoneå±æ€§ä¸ºtrueã€‚ä»¥åå†è°ƒç”¨nextæ–¹æ³•ï¼Œè¿”å›çš„éƒ½æ˜¯è¿™ä¸ªå€¼ã€‚
::: tip
æ€»ç»“ä¸€ä¸‹ï¼šè°ƒç”¨Generatorå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä»£è¡¨Generatorå‡½æ•°çš„å†…éƒ¨æŒ‡é’ˆã€‚ä»¥åï¼Œæ¯æ¬¡è°ƒç”¨éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæœ‰ç€valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚valueå±æ€§è¡¨ç¤ºå½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å€¼ï¼Œæ˜¯yieldè¡¨è¾¾å¼åé¢é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›doneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦éå†ç»“æŸã€‚
:::
## Generatorå‡½æ•°å®ä¾‹åº”ç”¨
1. å‘é€ajaxè¯·æ±‚è·å–æ–°é—»å†…å®¹ã€‚
2. æ–°é—»å†…å®¹è·å–æˆåŠŸåå†æ¬¡å‘é€è¯·æ±‚ï¼Œè·å–å¯¹åº”çš„æ–°é—»è¯„è®ºã€‚
3. æ–°é—»å†…å®¹è·å–å¤±è´¥åˆ™ä¸éœ€è¦å†æ¬¡å‘é€è¯·æ±‚ã€‚

```js
function* sendRequest() {
    const url = yield getData('http://www.example.com/news?newsID=123');
    yield getData(url);
}

function getData(url) {
    $.get(url, data => {
        console.log(data);
        const commentsUrl = data.commentsUrl;
        const resUrl = `http://www.example.com/${commentsUrl}`;
        // å½“è·å–æ–°é—»å†…å®¹æˆåŠŸï¼Œå‘é€è¯·æ±‚è·å–å¯¹åº”çš„è¯„è®ºå†…å®¹
        // è°ƒç”¨nextä¼ å‚ä¼šä½œä¸ºä¸Šæ¬¡æš‚åœæ˜¯yieldçš„è¿”å›å€¼
        gen.next(resUrl);
    });
}

const gen = sendRequest();
gen.next(); // å‘é€è·å–æ–°é—»å†…å®¹è¯·æ±‚
```
## ç»™å¯¹è±¡æ·»åŠ iteratoræ¥å£
```js
const objIterable = {};
objIterable[Symbol.iterator] = function* () {
    yield 'hello';
    yield 'world';
    yield 'end';
}

for (const i of objIterable) {
    console.log(i);
}

const obj = [...objIterable];
console.log(obj); // [ 'hello', 'world', 'end' ]
```
è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š
```js
hello
world
end
[ 'hello', 'world', 'end' ]
```
## Generatorå‡½æ•°çš„å¼‚æ­¥åº”ç”¨
## Thunkå‡½æ•°
Thunkå‡½æ•°æ˜¯è‡ªåŠ¨æ‰§è¡ŒGeneratorå‡½æ•°çš„ä¸€ç§æ–¹æ³•ã€‚
### å‚æ•°çš„æ±‚å€¼ç­–ç•¥
* ä¼ å€¼è°ƒç”¨
* ä¼ åè°ƒç”¨
```js
const a = 1;
function fn(b) {
    return b * 3;
}

fn(a + 5);
```
ä¸Šè¿°ä»£ç é‡‡ç”¨**ä¼ å€¼è°ƒç”¨**ç­–ç•¥çš„è¯ï¼Œåœ¨è¿›å…¥å‡½æ•°ä½“ä¹‹å‰ï¼Œå°±éœ€è¦è®¡ç®—a + 5çš„å€¼(ç­‰äº6)ï¼Œå†å°†è¿™ä¸ªå€¼ä½œä¸ºå®å‚ä¼ å…¥å‡½æ•°fnã€‚Cè¯­è¨€å°±é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚
```js
fn(a + 5);
// ä¼ å€¼è°ƒç”¨ç›¸å½“äº
fn(6);
```
å¦ä¸€ç§ç­–ç•¥æ˜¯**ä¼ åè°ƒç”¨**ï¼Œå³ç›´æ¥å°†è¡¨è¾¾å¼`x + 5`ä¼ å…¥å‡½æ•°ä½“ï¼Œ**åªåœ¨ç”¨åˆ°å®ƒçš„æ—¶å€™æ±‚å€¼**ã€‚Haskellè¯­è¨€é‡‡ç”¨è¿™ç§ç­–ç•¥ã€‚
```js
fn(a + 5)
// ä¼ åè°ƒç”¨æ—¶ï¼Œç­‰åŒäº
(a + 5) * 2
```
::: warning
ä¼ å€¼è°ƒç”¨å’Œä¼ åè°ƒç”¨ï¼Œå“ªä¸€ç§æ¯”è¾ƒå¥½ï¼Ÿ
:::
å›ç­”æ˜¯å„æœ‰åˆ©å¼Šã€‚ä¼ å€¼è°ƒç”¨æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¯¹å‚æ•°æ±‚å€¼çš„æ—¶å€™ï¼Œå®é™…ä¸Šè¿˜æ²¡ç”¨åˆ°è¿™ä¸ªå‚æ•°ï¼Œæœ‰å¯èƒ½é€ æˆæ€§èƒ½æŸå¤±ã€‚ä¸¾ä¸ªğŸŒ°ï¼š
```js
function f(a, b) {
  return b;
}

f(3 * x * x - 2 * x - 1, x);
```
ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯å‡½æ•°ä½“å†…æ ¹æœ¬æ²¡ç”¨åˆ°ã€‚å¯¹è¿™ä¸ªå‚æ•°æ±‚å€¼ï¼Œå®é™…ä¸Šæ˜¯ä¸å¿…è¦çš„ã€‚å› æ­¤ï¼Œæœ‰ä¸€äº›è®¡ç®—æœºå­¦å®¶å€¾å‘äº**ä¼ åè°ƒç”¨**ï¼Œå³åªåœ¨æ‰§è¡Œæ—¶æ±‚å€¼ã€‚
### Thunkå‡½æ•°çš„å«ä¹‰
ç¼–è¯‘å™¨çš„**ä¼ åè°ƒç”¨**å®ç°ï¼Œå¾€å¾€æ˜¯å°†å‚æ•°æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å‡½æ•°ä¹‹ä¸­ï¼Œå†å°†è¿™ä¸ªä¸´æ—¶å‡½æ•°ä¼ å…¥å‡½æ•°ä½“ã€‚è¿™ä¸ªä¸´æ—¶å‡½æ•°å°±å«åšThunkå‡½æ•°ã€‚
```js
const a = 1;

function thunk() {
    return a + 5;
}
function fn(thunk) {
    return thunk() * 3;
}

const res = fn(thunk);
console.log(res); // 18
```
ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•°fnçš„å‚æ•°`a + 5`è¢«ä¸€ä¸ªå‡½æ•°æ›¿æ¢äº†ã€‚å‡¡æ˜¯ç”¨åˆ°åŸå‚æ•°çš„åœ°æ–¹ï¼Œå¯¹Thunkå‡½æ•°æ±‚å€¼å³å¯ã€‚è¿™å°±æ˜¯Thunkå‡½æ•°çš„å®šä¹‰ï¼Œå®ƒæ˜¯**ä¼ åè°ƒç”¨**çš„ä¸€ç§å®ç°ç­–ç•¥ï¼Œç”¨æ¥æ›¿æ¢æŸä¸ªè¡¨è¾¾å¼ã€‚
### jsä¸­çš„Thunkå‡½æ•°
jsæ˜¯ä¼ å€¼è°ƒç”¨ï¼Œå®ƒçš„Thunkå‡½æ•°å«ä¹‰æœ‰æ‰€ä¸åŒã€‚åœ¨jsä¸­ï¼ŒThunkå‡½æ•°æ›¿æ¢çš„ä¸æ˜¯è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å¤šå‚æ•°å‡½æ•°ï¼Œå°†å…¶æ›¿æ¢æˆä¸€ä¸ªåªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°çš„å•å‚æ•°å‡½æ•°ã€‚
```js
const fs = require('fs');

// Thunkå‡½æ•°è½¬æ¢å™¨
function thunk(fn) {
    return function() {
        const args = Array.prototype.slice.call(arguments);
        return function(callback) {
            args.push(callback);
            return fn.apply(null, args);
        }
    }
}

// fs.readFile('./name.txt', 'utf8', (err, data) => {
//     console.log(data.toString());
// });

// å®ç°Thunkç‰ˆæœ¬çš„readFile
const thunkReadfile = thunk(fs.readFile);
thunkReadfile('./name.txt', 'utf8')((err, data) => {
    console.log(data.toString());
});
```
```js
// ES6ä¹‹callç‰ˆæœ¬Thunkå‡½æ•°è½¬æ¢å™¨
const thunk = fn => (...args) => {
    return callback => fn.call(null, ...args, callback);
}
// ES6ä¹‹applyç‰ˆæœ¬Thunkå‡½æ•°è½¬æ¢å™¨
const thunk = fn => (...args) => {
    return callback => fn.apply(null, args.concat(callback));
}
```
ä»»ä½•å‡½æ•°ï¼Œåªè¦å‚æ•°æœ‰å›è°ƒå‡½æ•°ï¼Œå°±èƒ½å†™æˆThunkå‡½æ•°çš„å½¢å¼ã€‚
### Thunkifyæ¨¡å—
ç”Ÿäº§ç¯å¢ƒçš„è½¬æ¢å™¨ï¼Œå»ºè®®ä½¿ç”¨Thunkifyæ¨¡å—ã€‚
```js
yarn add thunkify
```
ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```js
const thunkify = require('thunkify');
const fs = require('fs');

const read = thunkify(fs.readFile);
read('package.json')((err, data) => {
  // ...
});
```
## Generatorå‡½æ•°çš„æµç¨‹ç®¡ç†
```js
function* gen() {
    yield 1;
    yield 2;
    yield 3;
}

const g = gen();
let res = g.next();

// è‡ªåŠ¨æ‰§è¡Œ
while(!res.done) {
    console.log(res);
    res = g.next();
}
```
## coæ¨¡å—
::: tip
coæ¨¡å—çš„ä¸»è¦ä½œç”¨æ˜¯ï¼šç”¨äºGeneratorå‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œã€‚
:::
coå…·ä½“åšçš„äº‹æƒ…ï¼š
1. æ¥å—ä¸€ä¸ªgeneratorå‡½æ•°ä½œä¸ºè¾“å…¥ï¼Œè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼›
2. éå†æ•´ä¸ªgenerator(å³ä¸æ–­çš„è°ƒç”¨next)ï¼›
   1. åœ¨éå†ç»“æŸæ—¶(å³nextè¿”å›çš„å¯¹è±¡done: false)è¿›è¡Œresolveï¼Œresolveæ‰€æŒæœ‰çš„å€¼æ˜¯æœ€åä¸€ä¸ªnextè¾“å‡ºçš„value
   2. åœ¨éå†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯åˆ™ reject
3. ä»…æ”¯æŒgeneratorå‡½æ•°ä¸­yieldéç©ºå¯¹è±¡(ä¸æ”¯æŒ primitive types å¦‚ number, string ç­‰)ã€‚

coå®é™…å¯¹å¤–æä¾›äº†2ç§apiï¼š
* æ— å‚æ•°çš„ï¼šco(fn *)
* æœ‰å‚æ•°çš„ï¼šco.wrap(fn *)

æ¥çœ‹ä¸ªæ— å‚æ•°çš„ğŸŒ°ï¼š
```js
const {fs} = require('mz');
const co = require('co');
function* gen() {
    // ä¾æ¬¡è¯»å–ä¸¤ä¸ªæ–‡ä»¶
    const name = yield fs.readFile('name.txt', 'utf8');
    const age = yield fs.readFile('age.txt', 'utf8');
    console.log(name.toString());
    console.log(age.toString());
}

co(gen);
```
ä¸Šé¢ä»£ç ä¸­ï¼ŒGeneratorå‡½æ•°åªè¦ä¼ å…¥coå‡½æ•°ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š
```js
lisi
18
```
coå‡½æ•°è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚
```js
co(gen).then(() => {
    console.log('genå‡½æ•°æ‰§è¡Œå®Œæ¯•');
});
```
ä¸Šé¢ä»£ç ä¸­ï¼Œç­‰åˆ°Generatorå‡½æ•°æ‰§è¡Œç»“æŸï¼Œå°±ä¼šè¾“å‡ºä¸€è¡Œæç¤ºã€‚
```js
const {fs} = require('mz');
const co = require('co');

function* read() {
    const name = yield fs.readFile('name.txt', 'utf8');
    const age = yield fs.readFile('age.txt', 'utf8');
    const a = yield [1, 2, 3];
    return age + a;
}
// coæ¥æ”¶generatorå‚æ•°ï¼Œè¿”å›çš„æ˜¯Promise
co(read).then(data => console.log(data)); // 121,2,3
```
```js
// mzæ¨¡å—æŠŠnodeä¸­çš„ä¸€äº›å¸¸ç”¨æ¨¡å—promiseåŒ–äº†
const {fs} = require('mz');
function* read() {
    let filename = yield fs.readFile('./name.txt', 'utf8');
    let age = yield fs.readFile(filename, 'utf8');
    let b = yield [1, 2, 3];
    return age + b;
}
// const co = require('co');
// å®ç°co
function co(it) {// express koa
    // è¿”å›çš„æ˜¯Promise
    return new Promise((resolve, reject) => {
        function next(r) { // å¦‚æœç¢°åˆ°å¼‚æ­¥è¿­ä»£ éœ€è¦å€ŸåŠ©ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°æ¥å®ç°ï¼Œä¿è¯ç¬¬ä¸€æ¬¡æ‰§è¡Œåè°ƒç”¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ
            const {value, done} = it.next(r);
            if(!done) { // babel
                // ä¸ç®¡valueæ˜¯ä»€ä¹ˆç±»å‹ï¼Œéƒ½åŒ…è£…æˆpromise
                Promise.resolve(value).then(r => {
                    next(r);
                }, err => {
                    reject(err);
                });
            } else { // å®Œæˆäº†èµ°æˆåŠŸ
                resolve(value);
            }
        }
        next();
    });
}
// coæ¥æ”¶generatorå‚æ•°ï¼Œè¿”å›çš„æ˜¯Promise
co(read()).then(data=>{
    console.log(data);
});
```
å†æ¥çœ‹ä¸ªæœ‰å‚æ•°çš„ğŸŒ°ï¼š
```js
const co = require('co');

function* gen() {
    console.log(arguments); // { '0': 123, '1': 456, '2': 789 }
    const a = Promise.resolve(1);
    const b = Promise.resolve(2);
    const  c= Promise.resolve(3);
    const res = yield [a, b, c];
    return res;
}

const coWrap = co.wrap(gen);
// [ 1, 2, 3 ]
coWrap(123, 456, 789).then(
    data => {
        console.log(data);
    }).catch(err => console.log(err));
```
### coæ ¸å¿ƒåŸç†
coçš„æ ¸å¿ƒåŸç†åœ¨äºï¼šnextå‡½æ•°ï¼Œè¿™é‡Œå°†æ¯ä¸€æ¬¡yieldçš„è¿”å›å€¼åŒ…è£…æˆPromiseå¯¹è±¡ï¼Œåœ¨Promiseçš„onFulfilledå’ŒonRejectedçŠ¶æ€ä¸­ç»§ç»­é€’å½’è°ƒç”¨nextå‡½æ•°ï¼Œä¿è¯é“¾å¼è°ƒç”¨è‡ªåŠ¨æ‰§è¡Œï¼Œä½¿å¾—å¼‚æ­¥çš„ä»£ç èƒ½å¤Ÿä»¥åŒæ­¥çš„æ–¹å¼è¿è¡Œã€‚

å°†yieldè¿”å›å¯¹è±¡çš„valueå€¼è½¬æ¢ä¸ºä¸€ä¸ªPromiseå¯¹è±¡ï¼Œæ‰§è¡Œè¯¥Promiseå³å¯æ‹¿åˆ°ç¨‹åºçš„æ‰§è¡Œæƒã€‚ç„¶åé€šè¿‡åœ¨onFulfilledå’ŒonRejectedä¸­ç»§ç»­è°ƒç”¨nextæ–¹æ³•å¯ä»¥äº¤è¿˜ç¨‹åºæ‰§è¡Œæƒï¼Œå¦‚æ­¤è¾¾åˆ°è‡ªåŠ¨æ‰§è¡Œgeneratorå‡½æ•°çš„æ•ˆæœã€‚
## å‚è€ƒæ–‡æ¡£
1. [Generator å‡½æ•°çš„è¯­æ³•](http://es6.ruanyifeng.com/#docs/generator)
2. [æ·±å…¥ç†è§£koaä¸­çš„coæºç ](https://www.cnblogs.com/tugenhua0707/p/10505463.html)
3. [ä½ ä¸æ‡‚JS: å¼‚æ­¥ä¸æ€§èƒ½-Generator](https://github.com/getify/You-Dont-Know-JS/blob/1ed-zh-CN/async%20%26%20performance/ch4.md)
4. [åŸºäº Generator ä¸ Promise çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ](https://morning.work/page/maintainable-nodejs/asynchronous-programming.html)