---
title: 10. Async/Await
---
[TOC]
Async/Awaitæ˜¯ECMAScriptæ–°å¼•å…¥çš„è¯­æ³•ï¼Œèƒ½å¤Ÿæå¤§åœ°ç®€åŒ–å¼‚æ­¥ç¨‹åºçš„ç¼–å†™ï¼Œä¸‹é¢ä¸»è¦æ¥ä»‹ç»ä¸€ä¸‹`Async/Await`çš„ç”¨æ³•ä»¥åŠä¸ä¼ ç»Ÿæ–¹å¼çš„å¯¹æ¯”ï¼Œé€šè¿‡æ ·ä¾‹ä½“ç°äº†`Async/Await`çš„ä¼˜åŠ¿ã€‚

asyncå‡½æ•°æ˜¯**Generatorå‡½æ•°çš„è¯­æ³•ç³–**ã€‚ä½¿ç”¨å…³é”®å­—asyncæ¥è¡¨ç¤ºï¼Œåœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨awaitæ¥è¡¨ç¤ºå¼‚æ­¥ã€‚æ˜¯çœŸæ­£æ„ä¹‰ä¸Šå»è§£å†³å¼‚æ­¥å›è°ƒçš„é—®é¢˜ï¼ŒåŒæ­¥æµç¨‹è¡¨è¾¾å¼‚æ­¥æ“ä½œã€‚
ç›¸è¾ƒäºGeneratorï¼Œasyncå‡½æ•°çš„æ”¹è¿›åœ¨äºä¸‹é¢å‡ ç‚¹ï¼š

1. **å†…ç½®æ‰§è¡Œå™¨**ï¼š`Generator`å‡½æ•°çš„æ‰§è¡Œå¿…é¡»ä¾é æ‰§è¡Œå™¨ï¼Œè€Œasyncå‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ï¼Œä¸éœ€è¦åƒGeneratorå»è°ƒç”¨nextæ–¹æ³•ï¼Œé‡åˆ°awaitç­‰å¾…ï¼Œå½“å‰çš„å¼‚æ­¥æ“ä½œå®Œæˆå°±å¾€ä¸‹æ‰§è¡Œã€‚**è°ƒç”¨æ–¹å¼è·Ÿæ™®é€šå‡½æ•°çš„è°ƒç”¨ä¸€æ ·**ã€‚
2. **æ›´å¥½çš„è¯­ä¹‰**ï¼šasyncå…³é”®å­—å–ä»£Generatorå‡½æ•°çš„æ˜Ÿå·*ï¼Œawaitå–ä»£Generatorçš„yieldï¼Œ`asyncå’Œawait`ç›¸è¾ƒäº`* å’Œyield`æ›´åŠ è¯­ä¹‰åŒ–ï¼›
3. **æ›´å¹¿çš„é€‚ç”¨æ€§**ï¼šcoæ¨¡å—çº¦å®šï¼Œ`yield`å‘½ä»¤åé¢åªèƒ½æ˜¯`Thunk`å‡½æ•°æˆ–`Promise`å¯¹è±¡ã€‚è€Œ`async`å‡½æ•°çš„`await`å‘½ä»¤åé¢åˆ™å¯ä»¥æ˜¯`Promise`æˆ–è€…åŸå§‹ç±»å‹çš„å€¼(Numberï¼Œstringï¼Œbooleanï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œ)ï¼›
4. **è¿”å›å€¼æ˜¯Promise**ï¼š`async`å‡½æ•°è¿”å›å€¼æ˜¯`Promise`å¯¹è±¡(é»˜è®¤æ˜¯æˆåŠŸæ€ï¼Œå¹¶ä¸”æŠŠè¯¥å‡½æ•°çš„è¿”å›å€¼ä¼ ç»™thençš„ç¬¬ä¸€ä¸ªå‚æ•°)ï¼Œæ¯”`Generator`å‡½æ•°è¿”å›çš„`Iterator`å¯¹è±¡æ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`then()`æ–¹æ³•è¿›è¡Œä¸‹ä¸€æ­¥è°ƒç”¨ã€‚
5. **ä»£ç é€»è¾‘æ›´æ¸…æ™°**ï¼š`async/await`çš„ä¼˜åŠ¿åœ¨äºèƒ½æ›´å¥½çš„å¤„ç†`then`é“¾ï¼Œç‰¹åˆ«æ˜¯æœ‰å¤šä¸ª`Promise`ç»„æˆçš„`then`é“¾çš„æ—¶å€™ï¼Œä¼˜åŠ¿å°±ä½“ç°å‡ºæ¥äº†ã€‚

asyncæ˜¯ES7æ–°å‡ºçš„ç‰¹æ€§ï¼Œ**è¡¨æ˜å½“å‰å‡½æ•°æ˜¯å¼‚æ­¥å‡½æ•°**ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹å¯¼è‡´åç»­ä»£ç åœæ­¢è¿è¡Œã€‚
```js
const asyncFn = async () => {
    return 'æˆ‘åæ‰§è¡Œ'
}
asyncFn().then(result => {
    console.log(result);
})
console.log('æˆ‘å…ˆæ‰§è¡Œ');
// è¿è¡Œç»“æœï¼š
æˆ‘å…ˆæ‰§è¡Œ
æˆ‘åæ‰§è¡Œ
```
è™½ç„¶æ˜¯ä¸Šé¢asyncFn()å…ˆæ‰§è¡Œï¼Œä½†æ˜¯å·²ç»è¢«å®šä¹‰å¼‚æ­¥å‡½æ•°äº†ï¼Œä¸ä¼šå½±å“åç»­å‡½æ•°çš„æ‰§è¡Œã€‚
```js
console.log(2);
async function fn() {
    console.log(1);
    // awaitä¼šæŠŠå…¶ä¸‹é¢çš„ä»£ç å˜æˆå¾®ä»»åŠ¡ï¼Œæ˜¯å¼‚æ­¥çš„
    await 'ç­‰å¾…';
    console.log(3);
}
fn();
console.log(4);
// è¿è¡Œç»“æœï¼š
2
1
4
3
```
```js
function bar() {
    console.log(5);
}
console.log(2);
async function fn() {
    console.log(1);
    // awaitä¼šæŠŠä¸‹é¢çš„ä»£ç å˜æˆå¾®ä»»åŠ¡ï¼Œæ˜¯å¼‚æ­¥çš„
    await bar(); // barå‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œ
    console.log(3);
}
fn();
console.log(4);
// è¿è¡Œç»“æœï¼š
2
1
5
4
3
```
```js
function bar() {
    return new Promise((resolve, reject) => {
        console.log(5);
    });
}
console.log(2);
async function fn() {
    console.log(1);
    // awaitä¼šæŠŠä¸‹é¢çš„ä»£ç å˜æˆå¾®ä»»åŠ¡ï¼Œæ˜¯å¼‚æ­¥çš„
    await bar();
    console.log(3);
}
fn();
console.log(4);
// è¿è¡Œç»“æœï¼š
2
1
5
4
```
```js
function bar() {
    return new Promise((resolve, reject) => {
        console.log(5);
        resolve();
    });
}
console.log(2);
async function fn() {
    console.log(1);
    // awaitä¼šæŠŠä¸‹é¢çš„ä»£ç å˜æˆå¾®ä»»åŠ¡ï¼Œæ˜¯å¼‚æ­¥çš„
    await bar();
    // awaitä¸‹é¢çš„ä»£ç å—barå‡½æ•°è¿”å›çš„Promiseå®ä¾‹çš„çŠ¶æ€å½±å“
    console.log(3);
}
fn();
console.log(4);
// è¿è¡Œç»“æœï¼š
2
1
5
4
3
```
::: tip
é€šè¿‡ä¸Šè¿°3ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼šå¦‚æœbarå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªéPromiseå€¼ï¼Œåˆ™å¾®ä»»åŠ¡ä¸­ä»£ç ä¼šç«‹å³æ‰§è¡Œï¼›å¦‚æœè¿”å›Promiseå®ä¾‹ï¼Œåˆ™ä¼šç­‰åˆ°PromiseçŠ¶æ€å˜åŒ–å(å˜ä¸ºæˆåŠŸæ€)æ‰ä¼šæ‰§è¡Œã€‚
:::
```js
function bar() {
    return new Promise((resolve, reject) => {
        console.log(5);
        setTimeout(() => {
            resolve();
        }, 1000);
    });
}
console.log(2);
async function fn() {
    console.log(1);
    // awaitä¼šæŠŠä¸‹é¢çš„ä»£ç å˜æˆå¾®ä»»åŠ¡ï¼Œæ˜¯å¼‚æ­¥çš„
    await bar();
    // å¦‚æœbarå‡½æ•°æ‰§è¡Œä¸­æœ‰å¼‚æ­¥ï¼Œé‚£ä¹ˆawaitä¸‹é¢çš„ä»£ç ä¼šç­‰åˆ°å‡½æ•°ä¸­çš„å¼‚æ­¥æ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œè¿™ä¸ªå¾®ä»»åŠ¡
    console.log(3);
}
fn();
console.log(4);
```
```js
function bar(time) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve();
        }, time);
    });
}
console.log(2);
async function fn() {
    console.log(1);
    // awaitä¼šæŠŠä¸‹é¢çš„ä»£ç å˜æˆå¾®ä»»åŠ¡ï¼Œæ˜¯å¼‚æ­¥çš„
    await bar(1000);
    await bar(3000);
    // 4ç§’åæ‰ä¼šè¾“å‡º3
    // å¦‚æœbarå‡½æ•°æ‰§è¡Œä¸­æœ‰å¼‚æ­¥ï¼Œé‚£ä¹ˆawaitä¸‹é¢çš„ä»£ç ä¼šç­‰åˆ°å‡½æ•°ä¸­çš„å¼‚æ­¥æ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œè¿™ä¸ªå¾®ä»»åŠ¡
    console.log(3);
}
fn();
console.log(4);
```
```js
const asyncFn = async () => {
    return 'æˆ‘åæ‰§è¡Œ'
};
console.log(asyncFn());
```
è¿è¡Œç»“æœï¼š
```js
PromiseÂ {<resolved>: "æˆ‘åæ‰§è¡Œ"}
```
::: warning
éœ€è¦æ³¨æ„ï¼šasyncå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚asyncå‡½æ•°ï¼ˆåŒ…å«å‡½æ•°è¯­å¥ã€å‡½æ•°è¡¨è¾¾å¼ã€Lambdaè¡¨è¾¾å¼ï¼‰ä¼šè¿”å›ä¸€ä¸ª`Promise`å¯¹è±¡ï¼Œå¦‚æœåœ¨å‡½æ•°ä¸­returnä¸€ä¸ªç›´æ¥é‡ï¼Œ`async`ä¼šæŠŠè¿™ä¸ªç›´æ¥é‡é€šè¿‡`Promise.resolve()`å°è£…æˆ`Promise`å¯¹è±¡ã€‚è¯¥Promiseå¯¹è±¡ï¼Œæœ€ç»ˆresolveçš„å€¼å°±æ˜¯åœ¨å‡½æ•°ä¸­returnçš„ç›´æ¥é‡çš„å†…å®¹ã€‚
:::
## asyncå’Œawait
å…ˆä»å­—é¢æ„æ€æ¥ç†è§£ï¼Œ`async`æ˜¯å¼‚æ­¥çš„ç®€å†™ï¼Œè€Œ`await`å¯ä»¥è®¤ä¸ºæ˜¯`async wait`çš„ç®€å†™ã€‚æ‰€ä»¥åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œ`async`ç”¨äºç”³æ˜ä¸€ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ`await`ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚
## async-awaitå’ŒPromiseçš„å…³ç³»
async-awaitæ˜¯Promiseå’Œgeneratorçš„è¯­æ³•ç³–ã€‚åªæ˜¯ä¸ºäº†è®©æˆ‘ä»¬ä¹¦å†™ä»£ç æ—¶æ›´åŠ æµç•…ï¼Œå½“ç„¶ä¹Ÿå¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§ã€‚ç®€å•æ¥è¯´ï¼š`async-await`æ˜¯å»ºç«‹åœ¨`promise`æœºåˆ¶ä¹‹ä¸Šçš„ï¼Œå¹¶ä¸èƒ½å–ä»£å…¶åœ°ä½ã€‚
## åŸºæœ¬è¯­æ³•
```js
async function fn() {
 	// awaitä¼šæŠŠç»“æœè½¬åŒ–ä¸ºä¸€ä¸ªPromiseå¯¹è±¡
    const result = await Math.random();
    console.log(result);
}
fn();
```
### async
asyncç”¨æ¥å£°æ˜å‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œå®šä¹‰çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª`Promise`å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚

```js
async function demo1(params) {
    return 'demo1';
}

demo1().then(val => {
    console.log(val); // 'demo1'
});
```
```js
async function fn(params) {
    console.log('111');
}
fn().then(v => console.log(v));
```
è¿è¡Œç»“æœï¼š
```js
111
undefined
```
è‹¥asyncå®šä¹‰çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œ`return 123;`ç›¸å½“äº`Promise.resolve(123)`ï¼Œæ²¡æœ‰å£°æ˜å¼çš„returnåˆ™ç›¸å½“äºæ‰§è¡Œäº†`Promise.resolve(undefined)`;

### await(ç†è§£ä¸ºasync wait)
awaitå¯ä»¥ç†è§£ä¸ºæ˜¯`async wait`(å¼‚æ­¥ç­‰å¾…)çš„ç®€å†™ã€‚awaitå…³é”®å­—åªèƒ½å‡ºç°åœ¨asyncå‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚ä»»ä½•`async`å‡½æ•°éƒ½ä¼šé»˜è®¤è¿”å›`Promise`ï¼Œå¹¶ä¸”è¿™ä¸ª`Promise`è§£æçš„å€¼éƒ½å°†ä¼šæ˜¯è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œè€Œ`async`å‡½æ•°å¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰çš„`await`å‘½ä»¤çš„`Promise`å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜ã€‚

awaitåé¢å¯ä»¥è·Ÿä»»ä½•çš„JSè¡¨è¾¾å¼ã€‚è™½ç„¶è¯´`await`å¯ä»¥ç­‰å¾ˆå¤šç±»å‹çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®ƒæœ€ä¸»è¦çš„æ„å›¾æ˜¯ç”¨æ¥ç­‰å¾…`Promise`å¯¹è±¡çš„çŠ¶æ€è¢«`resolved`ã€‚å¦‚æœ`await`çš„æ˜¯`Promise`å¯¹è±¡ä¼šé€ æˆå¼‚æ­¥å‡½æ•°åœæ­¢æ‰§è¡Œå¹¶ä¸”ç­‰å¾…`Promise`çš„è§£å†³ï¼Œå¦‚æœç­‰çš„æ˜¯æ­£å¸¸çš„è¡¨è¾¾å¼åˆ™ç«‹å³æ‰§è¡Œã€‚
## ç®€å•åº”ç”¨
```js
async function sendRequest(url) {
    return new Promise((resolve, reject) => {
        $.ajax({
            url,
            type: 'GET',
            success: data => resolve(data),
            error: error => reject(error)
        });
    });
}

async function getNews(url) {
    const res = await sendRequest(url);
    // å†æ ¹æ®æ–°é—»å†…å®¹è¿”å›å€¼æ¥è·å–æ–°é—»çš„è¯„è®º
    const res2 = await sendRequest(res.commentsUrl);
    console.log(res, res2);
}

getNews('http://www.example.com/news?newsID=123'); // å…ˆè·å–æ–°é—»å†…å®¹
```
## Asyncå‡½æ•°çš„é”™è¯¯å¤„ç†
```js
let a;

const testFn = async () => {
    await Promise.reject('error');
    a = await 1; // è¿™è¡Œä»£ç ä¸ä¼šè¢«æ‰§è¡Œ
}

testFn().then(() => console.log(a));
```
å¦‚ä¸Šé¢ä»£ç æ‰€ç¤ºï¼šå½“asyncå‡½æ•°ä¸­åªè¦ä¸€ä¸ªawaitå‡ºç°rejectçŠ¶æ€ï¼Œåˆ™åé¢çš„awaitéƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚è§£å†³åŠæ³•ï¼šå¯ä»¥æ·»åŠ try/catchã€‚

```js
let a;

const testFn = async () => {
    try {
        await Promise.reject('error');
    } catch(error) {
        console.error(error);
    }
    a = await 1;
}

testFn().then(() => console.log(a));
```
```js
const testError = async () => {
    throw new Error('has Error');
}
testError()
    .then(success => console.log('æˆåŠŸ', success))
    .catch(error => console.log('å¤±è´¥', error)); // å¤±è´¥ Error: has Error
```

## demo
### åŸºç¡€ç¤ºä¾‹
```js
const axios = require('axios');

const getZhihuColumn = async (id) => {
	// è·å–çŸ¥ä¹å°ç®¡å®¶çš„ä¸“æ ä¿¡æ¯
    const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
    const response = await axios({
        url: url,
        method: 'GET'
    });
    console.log(`Name: ${response.data.name}`);
    console.log(`Intro: ${response.data.intro}`);
}

getZhihuColumn('zhihuadmin');
```
### å°†ä»»æ„å‡½æ•°å®šä¹‰æˆasyncé£æ ¼
```js
// å°†å‡½æ•°çš„ç»“æœåšä¸ºä¸€ä¸ªPromiseè¿”å›
const axios = require('axios');

const getZhihuColumn = async (id) => {
    const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
    return await axios({
        url: url,
        method: 'GET'
    });
}

getZhihuColumn('zhihuadmin')
    .then(response => {
        console.log(`Name: ${response.data.name}`);
        console.log(`Intro: ${response.data.intro}`);
    });
```
```js
const axios = require('axios');

class ApiClient {
    // å°†classä¸­çš„å‡½æ•°å®šä¹‰æˆasyncé£æ ¼
    async getZhihuColumn(id) {
        const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
        return await axios({
            url: url,
            method: 'GET'
        });
    }
}
// å°†ç«‹å³æ‰§è¡Œå‡½æ•°å®šä¹‰ä¸ºasyncé£æ ¼
(async () => {
    const client = new ApiClient();
    client.getZhihuColumn('zhihuadmin')
        .then(response => {
            console.log(`Name: ${response.data.name}`);
            console.log(`Intro: ${response.data.intro}`);
            console.log(`Description: ${response.data.description}`)
        });
})();
```
### asyncå‡½æ•°ä¸­çš„é”™è¯¯å¤„ç†
```js
const axios = require('axios');

const getZhihuColumn = async id => {
    const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
    const response = await axios({
        url: url,
        method: 'GET'
    });
    console.log(response.status, response.statusText); // 200 'OK'
    if (response.status !== 200) {
        throw new Error(response.statusText);
    }
    return await response;
}

// å¤„ç†asyncå‡½æ•°ä¸­çš„é”™è¯¯
const showColunmInfo = async id => {
    try {
        const response = await getZhihuColumn(id);
        console.log(`Name: ${response.data.name}`);
        console.log(`Intro: ${response.data.intro}`);
    } catch (err) {
        console.error(err);
    }
}

showColunmInfo('zhihuadmin11');
```
### å¤šä¸ªawaitä¸²è¡Œ
```js
const axios = require('axios');

const sleep = (timeout = 2000) => new Promise(resolve => {
    setTimeout(resolve, timeout);
});

const getZhihuColumn = async (id) => {
    await sleep(3000);
    const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
    return await axios({
        url: url,
        method: 'GET'
    });
}

// æ­£ç¡®å¤„ç†å¤šä¸ªawaitæ“ä½œçš„ä¸²è¡Œ
const showColumnInfo = async () => {
    console.time('showColumnInfo');
    const feweekly = await getZhihuColumn('feweekly');
    const response = await getZhihuColumn('zhihuadmin');

    console.log(`NAME: ${feweekly.data.name}`);
    console.log(`INTRO: ${feweekly.data.intro}`);

    console.log(`NAME: ${response.data.name}`);
    console.log(`INTRO: ${response.data.intro}`);
    console.timeEnd('showColumnInfo');
}

showColumnInfo();
// è¿è¡Œç»“æœï¼š
NAME: å‰ç«¯å‘¨åˆŠ
INTRO: åœ¨å‰ç«¯é¢†åŸŸè·Ÿä¸Šæ—¶ä»£çš„è„šæ­¥ï¼Œå¹¿åº¦å’Œæ·±åº¦ä¸æ–­ç²¾è¿›
NAME: çŸ¥ä¹å°ç®¡å®¶è¯´
INTRO: çŸ¥ä¹ç¤¾åŒºç®¡ç†å›¢é˜Ÿå®˜æ–¹ä¸“æ ï¼Œä¸å®šæœŸæ›´æ–°ç¤¾åŒºç®¡ç†å·¥ä½œâ€¦
showColumnInfo: 6653.686ms
```
### å¤šä¸ªawaitå¹¶è¡Œ
```js
const fetch = require('node-fetch');
const sleep = (timeout = 2000) => {
    return new Promise(resolve => setTimeout(resolve, timeout));
};
const getZhihuColumn = async id => {
    // å»¶è¿Ÿ2ç§’
    await sleep(2000);
    const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
    // è·å–åˆ°ä¸“æ æ•°æ®
    const response = await fetch(url);
    // è¿›è¡Œé”™è¯¯å¤„ç†
    if (response.status !== 200) {
        throw new Error(response.statusText);
    }
    // å°†è·å–åˆ°çš„æ•°æ®è½¬ä¸ºjson
    // asyncå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªPromise
    return await response.json();
}
// å¤„ç†asyncå‡½æ•°ä¸­çš„é”™è¯¯
const getColumnInfo = async () => {
    console.time('getColumnInfo');
    try {
        // å¤šä¸ªawaitå¹¶è¡Œ
        // å…ˆå‘é€è¯·æ±‚å†await
        const feweeklyPromise = getZhihuColumn('feweekly');
        const toolingtipsPromise = getZhihuColumn('toolingtips');
        const column = await feweeklyPromise;
        const toolingtips = await toolingtipsPromise;
        console.log(`Title: ${column.title}`);
        console.log(`Intro: ${column.intro}`);

        console.log(`Title: ${toolingtips.title}`);
        console.log(`Intro: ${toolingtips.intro}`);
    } catch (error) {
        console.error(error);
    }
    console.timeEnd('getColumnInfo');
};

getColumnInfo();
```
<img :src="$withBase('/es6/async2.png')" alt="">
æ€»ç»“ï¼šå¯¹äºå¤šä¸ªè¯·æ±‚ï¼Œä¸€èˆ¬é‡‡ç”¨å¹¶è¡Œï¼Œå³å…ˆå‘é€è¯·æ±‚åœ¨awaitï¼ŒåŠ å¿«å“åº”é€Ÿåº¦ã€‚

### ä½¿ç”¨Promise.allå®ç°å¤šä¸ªawaitå¹¶è¡Œ
```js
const fetch = require('node-fetch');
const sleep = (timeout = 2000) => {
    return new Promise(resolve => setTimeout(resolve, timeout));
};
const getZhihuColumn = async id => {
    // å»¶è¿Ÿ2ç§’
    await sleep(2000);
    const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
    // è·å–åˆ°ä¸“æ æ•°æ®
    const response = await fetch(url);
    // è¿›è¡Œé”™è¯¯å¤„ç†
    if (response.status !== 200) {
        throw new Error(response.statusText);
    }
    // å°†è·å–åˆ°çš„æ•°æ®è½¬ä¸ºjson
    // asyncå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªPromise
    return await response.json();
}
// å¤„ç†asyncå‡½æ•°ä¸­çš„é”™è¯¯
const getColumnInfo = async () => {
    console.time('getColumnInfo');
    try {
        // ä½¿ç”¨Promise.allå®ç°å¤šä¸ªawaitå¹¶è¡Œ
        const feweeklyPromise = getZhihuColumn('feweekly');
        const toolingtipsPromise = getZhihuColumn('toolingtips');
        const [column, toolingtips] = await Promise.all([feweeklyPromise, toolingtipsPromise]);
        console.log(`Title: ${column.title}`);
        console.log(`Intro: ${column.intro}`);

        console.log(`Title: ${toolingtips.title}`);
        console.log(`Intro: ${toolingtips.intro}`);
    } catch (error) {
        console.error(error);
    }
    console.timeEnd('getColumnInfo');
};

getColumnInfo();
```
### å®ç°ä¸€ä¸ªsleepæ¯éš”1ç§’è¾“å‡º 1ï¼Œ 2ï¼Œ 3ï¼Œ 4ï¼Œ 5
å®ç°ä¸€ä¸ªsleepï¼Œæ¯éš”1ç§’è¾“å‡º1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ã€‚
```js
function sleep(time) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve();
        }, time);
    });
}

async function say() {
    for (let i = 0; i < 5; i++) {
        await sleep(1000);
        console.log(i + 1);
    }
}

say();
```
### å®ç°ä¸€ä¸ªçº¢ç»¿ç¯
å®ç°ä¸€ä¸ªçº¢ç»¿ç¯ï¼šçº¢ç¯2ç§’ï¼Œé»„ç¯1ç§’ï¼Œç»¿ç¯3ç§’
```js
/**
 * ğŸš¥æ•ˆæœ(çº¢ç»¿ç¯)
*/

function sleep(time) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve();
        }, time);
    });
}

async function changeColor(color, time) {
    console.log('å½“å‰é¢œè‰²ä¸ºï¼š', color);
    await sleep(time);
}

async function say() {
    await changeColor('çº¢è‰²', 2000);
    await changeColor('é»„è‰²', 1000);
    await changeColor('ç»¿è‰²', 3000);
}

say();
```
### ä½¿ç”¨ async å®ç° Promise.all()çš„æ•ˆæœ
// å†™æ³•ä¸€
```js
let [foo, bar] = await Promise.all([getFoo(), getBar()]);

// å†™æ³•äºŒ
let fooPromise = getFoo();
let barPromise = getBar();

let foo = await fooPromise;
let foo = await barPromise;
```
ä¸Šé¢ä¸¤ç§å†™æ³•ï¼ŒgetFoo å’Œ getBar éƒ½æ˜¯åŒæ—¶è§¦å‘çš„ï¼Œè¿™æ ·å°±ä¼šç¼©çŸ­ç¨‹åºçš„æ‰§è¡Œæ—¶é—´ã€‚
## bluebirdä½¿ç”¨
```js
const bluebird = require('bluebird');

//ç»“åˆ await å’Œä»»æ„å…¼å®¹ .then() çš„ä»£ç 
const main = async () => {
  console.log('waiting...');
  await bluebird.delay(2000);
  console.log('done!');
}

main();
```
## åœ¨å¾ªç¯ä¸­ä½¿ç”¨await
### ä¸²è¡Œ
```js
const fetch = require('node-fetch');
const bluebird = require('bluebird');

async function getZhihuColumn(id) {
  await bluebird.delay(1000);
  const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
  const response = await fetch(url);
  return await response.json();
}

const getColumnInfo = async () => {
  console.time('getColumnInfo');
  const names = ['feweekly', 'toolingtips'];
  //åœ¨ for å¾ªç¯ä¸­æ­£ç¡®çš„ä½¿ç”¨ await
  // ä¸²è¡Œ
  for (const name of names) {
    const column = await getZhihuColumn(name);
    console.log(`Name: ${column.title}`);
    console.log(`Intro: ${column.intro}`);
  }
  console.timeEnd('getColumnInfo');
};

getColumnInfo();
```
### å¹¶è¡Œ
```js
const fetch = require('node-fetch');
const bluebird = require('bluebird');

async function getZhihuColumn(id) {
  await bluebird.delay(1000);
  const url = `https://zhuanlan.zhihu.com/api/columns/${id}`;
  const response = await fetch(url);
  return await response.json();
}

const getColumnInfo = async () => {
  console.time('getColumnInfo');
  const names = ['feweekly', 'toolingtips'];
  const promises = names.map(x => getZhihuColumn(x));
  //åœ¨ for å¾ªç¯ä¸­æ­£ç¡®çš„ä½¿ç”¨ await
  // å¹¶è¡Œï¼Œå…ˆå‘é€è¯·æ±‚å†await
  for (const promise of promises) {
    const column = await promise;
    console.log(`Name: ${column.name}`);
    console.log(`Intro: ${column.intro}`);
  }
  console.timeEnd('getColumnInfo');
};

getColumnInfo();
```
<img :src="$withBase('/es6/async.png')" alt="">

```js
const sleep = (time = 100) => new Promise(resolve => {
    setTimeout(resolve(time + 200), timeout);
});

const step1 = async (time) => {
    console.log(`step1 with ${time}`);
    return sleep(time);
}

const step2 = async (time) => {
    console.log(`step2 with ${time}`);
    return sleep(time);
}

const step3 = async (time) => {
    console.log(`step3 with ${time}`);
    return sleep(time);
}

function test() {
    console.log('test start');
    console.time('test');
    const time1 = 500;
    step1(time1)
        .then(time2 => step2(time2))
        .then(time3 => step2(time3))
        .then(res => {
            console.log(`result is ${res}`);
            console.timeEnd('test');
        });
}

test();
// è¿è¡Œç»“æœï¼š
test start
step1 with 500
step2 with 700
step2 with 900
result is 1100
test: 3.451ms
```
```js
const sleep = (time = 100) => new Promise(resolve => {
    setTimeout(resolve(time + 200), timeout);
});

const step1 = async (time) => {
    console.log(`step1 with ${time}`);
    return sleep(time);
}

const step2 = async (time) => {
    console.log(`step2 with ${time}`);
    return sleep(time);
}

const step3 = async (time) => {
    console.log(`step3 with ${time}`);
    return sleep(time);
}
// asyncå’Œawaitæ–¹å¼æ›´åŠ æ¸…æ™°
const test = async () => {
    console.log('test start111');
    console.time('test');
    const time1 = 500;
    const time2 = await step1(time1);
    const time3 = await step1(time2);
    const res = await step1(time3);
    console.log(`result is ${res}`);
    console.timeEnd('test');
}

test();
```
## asyncåŸç†
asyncå‡½æ•°åŸç†å°±æ˜¯Generatorå‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨åŒ…è£…äº†ä¸€ä¸‹ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯è‡ªå¸¦æ‰§è¡Œå™¨çš„Generatorå‡½æ•°ï¼Œè€ŒGeneratorå‡½æ•°éœ€è¦è°ƒç”¨nextæ–¹æ³•æ‰èƒ½æ‰§è¡Œã€‚
## å‚è€ƒæ–‡æ¡£
1. [ç†è§£ async/await](https://segmentfault.com/a/1190000010244279)
2. [ES6ç³»åˆ—æ–‡ç«  å¼‚æ­¥ç¥å™¨async-await](https://segmentfault.com/a/1190000011526612)
3. [ä¸€æ¬¡æ€§è®©ä½ æ‡‚async/awaitï¼Œè§£å†³å›è°ƒåœ°ç‹±](https://juejin.im/post/5b1ffff96fb9a01e345ba704)
4. [ç†è§£ JavaScript çš„ async/await](https://segmentfault.com/a/1190000007535316)
5. [ä¸ºä»€ä¹ˆè¯´Async/Awaitè®©ä»£ç æ›´ç®€æ´ï¼Ÿ](https://mp.weixin.qq.com/s/LwV_5Bjgp5mzzSbWz-xwSg)
6. [async å‡½æ•°çš„å«ä¹‰å’Œç”¨æ³•](http://www.ruanyifeng.com/blog/2015/05/async.html)
7. [ES6 ç³»åˆ—ä¹‹æˆ‘ä»¬æ¥èŠèŠ Async](https://juejin.im/post/5bcf3e3f6fb9a05cd53b3e3d)
