---
title: 5. Iterator(è¿­ä»£å™¨/éå†å™¨)
---
## ä»€ä¹ˆæ˜¯iterator
iteratoræ˜¯ä¸€ç§æ¥å£æœºåˆ¶ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶

Iteratorçš„ä½œç”¨ï¼š
1. ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›
2. ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—ï¼›
3. ES6åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤for...ofå¾ªç¯ï¼Œ**Iteratoræ¥å£ä¸»è¦ä¾›for...ofæ¶ˆè´¹**ã€‚

Iteratorçš„å·¥ä½œåŸç†ï¼š
1. åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„èµ·å§‹ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå†å™¨å¯¹è±¡æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚
2. ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„nextæ–¹æ³•ï¼ŒæŒ‡é’ˆè‡ªåŠ¨æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚
3. æ¥ä¸‹æ¥ä¸æ–­è°ƒç”¨nextæ–¹æ³•ï¼ŒæŒ‡é’ˆä¼šä¸€ç›´å¾€åç§»åŠ¨ï¼Œç›´åˆ°æŒ‡å‘æœ€åä¸€ä¸ªæˆå‘˜ã€‚
4. æ¯è°ƒç”¨nextæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«valueå’Œdoneçš„å¯¹è±¡ï¼Œ{value: å½“å‰æˆå‘˜çš„å€¼, done: å¸ƒå°”å€¼}
  4.1 valueè¡¨ç¤ºå½“å‰æˆå‘˜çš„å€¼ï¼Œdoneå¯¹åº”çš„å¸ƒå°”å€¼è¡¨ç¤ºå½“å‰çš„æ•°æ®ç»“æ„æ˜¯å¦éå†ç»“æŸã€‚
  4.2 å½“éå†ç»“æŸçš„æ—¶å€™è¿”å›çš„valueå€¼æ˜¯undefinedï¼Œdoneå€¼ä¸ºtrueã€‚

## åŸç”Ÿå…·å¤‡iteratoræ¥å£çš„æ•°æ®ç±»å‹
1. Array
2. arguments
3. set/map
4. String

æ¥çœ‹ä¸ªğŸŒ°ï¼š
```js
const arr = [1, 2, 3];
const it = arr[Symbol.iterator]();

let res;
do {
    res = it.next();
    console.log(res);
} while (!res.done);
```
å˜é‡arræ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŸç”Ÿå°±å…·æœ‰éå†å™¨æ¥å£ï¼Œéƒ¨ç½²åœ¨arrçš„`Symbol.iterator`å±æ€§ä¸Šé¢ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨è¿™ä¸ªå±æ€§ï¼Œå°±å¾—åˆ°éå†å™¨å¯¹è±¡ã€‚

å¯¹äºåŸç”Ÿéƒ¨ç½²Iteratoræ¥å£çš„æ•°æ®ç»“æ„ï¼Œä¸éœ€è¦è‡ªå·±å†™éå†å™¨ç”Ÿæˆå‡½æ•°ï¼Œ`for...of`å¾ªç¯ä¼šè‡ªåŠ¨éå†å®ƒä»¬ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–æ•°æ®ç»“æ„ï¼ˆä¸»è¦æ˜¯å¯¹è±¡ï¼‰çš„Iteratoræ¥å£ï¼Œéƒ½éœ€è¦è‡ªå·±åœ¨Symbol.iteratorå±æ€§ä¸Šé¢éƒ¨ç½²ï¼Œè¿™æ ·æ‰ä¼šè¢«for...ofå¾ªç¯éå†ã€‚
::: warning
éœ€è¦æ³¨æ„ï¼šå¯¹è±¡æ˜¯æ²¡æœ‰éƒ¨ç½²iteratoræ¥å£çš„ã€‚
:::
## ES6æ–¹æ³•å’Œiteratoræ¥å£çš„å…³ç³»
1. ä½¿ç”¨è§£æ„èµ‹å€¼ä»¥åŠ`...`ä¸‰ç‚¹è¿ç®—ç¬¦æ—¶ä¼šè°ƒç”¨iteratoræ¥å£ï¼›
2. Generatorå‡½æ•°çš„yeildè¯­å¥ä¼šè°ƒç”¨iteratoræ¥å£

## è‡ªå®šä¹‰iteratoræ¥å£(éå†å™¨å¯¹è±¡)
```js
function makeIterator(array) {
    let nextIndex = 0; // è®°å½•è®¿é—®æ•°æ®ç»“æ„çš„ä½ç½®
    return { // è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡
        next() {
            const done = nextIndex === array.length;
            const value = done ? undefined : array[nextIndex++];
            return {
                value,
                done
            };
        }
    };
}

const it = makeIterator(['a', 'b']);
let result;
do {
    result= it.next();
    console.log(result);
} while (!result.done);
/*
{ value: 'a', done: false }
{ value: 'b', done: false }
{ value: undefined, done: true }
*/
```
::: tip
éå†å™¨å¯¹è±¡çš„æ ¹æœ¬ç‰¹å¾ï¼š
1. å…·æœ‰nextæ–¹æ³•ï¼›
2. æ¯æ¬¡è°ƒç”¨nextæ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨åŒ…å«valueå’Œdoneä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚
:::
```js
const makeIterator = arr => {
    let nextIndex = 0;
    return {
        next() {
            const done = nextIndex >= arr.length;
            const value = done ? undefined : arr[nextIndex++];
            return {
                value,
                done
            }
        }
    };
};

const arr = [1, 2, 3];
const it = makeIterator(arr);
let res;
do {
    res = it.next();
    console.log(res);
} while (!res.done);
```
```js
{ value: 1, done: false }
{ value: 2, done: false }
{ value: 3, done: false }
{ value: undefined, done: true }
```
## ç»™å¯¹è±¡éƒ¨ç½²iteratoræ¥å£
ä¸€ç§æ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œæˆ‘ä»¬å°±ç§°è¿™ç§æ•°æ®ç»“æ„æ˜¯å¯éå†çš„(iterable)ã€‚ES6è§„å®šï¼Œé»˜è®¤çš„Iteratoræ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„`Symbol.iterator`å±æ€§ä¸Šã€‚
```js
const obj = {
    hobbies: ['ğŸ€', 'âš½ï¸', 'ä¹’ä¹“çƒ'],
    [Symbol.iterator]() {
        const self = this;
        let nextIndex = 0;
        return {
            next() {
                const done = nextIndex >= self.hobbies.length;
                const value = done ? undefined : self.hobbies[nextIndex++];
                return {
                    value,
                    done
                };
            }
        };
    }
};

for (let i of obj) {
    console.log(i);
}
```
è¾“å‡ºå¦‚ä¸‹ï¼š
```js
ğŸ€
âš½ï¸
ä¹’ä¹“çƒ
```
## è°ƒç”¨ Iterator æ¥å£çš„åœºåˆ
### è§£æ„èµ‹å€¼
```js
// å¯¹æ•°ç»„å’ŒSetç»“æ„è¿›è¡Œè§£æ„èµ‹å€¼æ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨Symbol.iteratoræ–¹æ³•ã€‚
const set = new Set().add(1).add(2).add(3);

console.log(set); // Set { 1, 2, 3 }
const [a, b] = set;
console.log(a, b); // 1 2

const [frist, ...rest] = set;
console.log(frist, rest); // 1 [ 2, 3 ]
```
### æ‰©å±•è¿ç®—ç¬¦
æ‰©å±•è¿ç®—ç¬¦(...)ä¹Ÿä¼šè°ƒç”¨é»˜è®¤çš„Iteratoræ¥å£ã€‚
```js
const str = 'hello';
console.log([...str]); // [ 'h', 'e', 'l', 'l', 'o' ]

const arr = [1, 2];
console.log([3, ...arr, 4]); // [ 3, 1, 2, 4 ]
```
::: tip
åªè¦æŸä¸ªæ•°æ®ç»“æ„(æ¯”å¦‚è¯´ç±»æ•°ç»„å’Œå­—ç¬¦ä¸²)éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œå°±å¯ä»¥å¯¹å®ƒä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†å…¶è½¬ä¸ºæ•°ç»„ã€‚
:::

### `yield*`
`yield*`åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£ã€‚
```js
const generator = function* () {
  yield 1;
  yield* [2,3,4];
  yield 5;
};

const it = generator();

it.next(); // { value: 1, done: false }
it.next(); // { value: 2, done: false }
it.next(); // { value: 3, done: false }
it.next(); // { value: 4, done: false }
it.next(); // { value: 5, done: false }
it.next(); // { value: undefined, done: true }
```
### å…¶ä»–åœºåˆ
ç”±äºæ•°ç»„çš„éå†ä¼šè°ƒç”¨éå†å™¨æ¥å£ï¼Œæ‰€ä»¥ä»»ä½•æ¥å—æ•°ç»„ä½œä¸ºå‚æ•°çš„åœºåˆï¼Œå…¶å®éƒ½è°ƒç”¨äº†éå†å™¨æ¥å£ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ã€‚

* for...of
* Array.from()
* Map(), Set(), WeakMap(), WeakSet()ï¼ˆæ¯”å¦‚new Map([['a',1],['b',2]])ï¼‰
* Promise.all()
* Promise.race()

## å­—ç¬¦ä¸²çš„Iteratoræ¥å£
```js
const str = 'hello';
// console.log(typeof str[Symbol.iterator]); // 'function'

const it = str[Symbol.iterator]();
let res;
do {
    res = it.next();
    console.log(res);
} while (!res.done);
```
è°ƒç”¨å­—ç¬¦ä¸²çš„Symbol.iteratoræ–¹æ³•è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªéå†å™¨ä¸Šå¯ä»¥è°ƒç”¨nextæ–¹æ³•ï¼Œå®ç°å¯¹äºå­—ç¬¦ä¸²çš„éå†ã€‚
```js
{ value: 'h', done: false }
{ value: 'e', done: false }
{ value: 'l', done: false }
{ value: 'l', done: false }
{ value: 'o', done: false }
{ value: undefined, done: true }
```
```js
const str = 'hello';
const proto = Object.getPrototypeOf(str);
// è¦†ç›–åŸç”Ÿçš„Symbol.iteratoræ–¹æ³•ï¼Œè¾¾åˆ°ä¿®æ”¹éå†å™¨è¡Œä¸ºçš„ç›®çš„
proto[Symbol.iterator] = function() {
    return {
        _frist: true,
        next() {
            if (this._frist) {
                this._frist = false;
                return {
                    value: 'bye',
                    done: false
                };
            } else {
                return {
                    value: undefined,
                    done: true
                };
            }
        }
    };
}

console.log([...str]); // [ 'bye' ]
console.log(str); // hello
```
ä¸Šè¿°ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²strçš„Symbol.iteratoræ–¹æ³•è¢«ä¿®æ”¹äº†ï¼Œæ‰€ä»¥æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰è¿”å›çš„å€¼å˜æˆäº†byeï¼Œè€Œå­—ç¬¦ä¸²æœ¬èº«è¿˜æ˜¯helloã€‚
## Iterator æ¥å£ä¸ Generatorå‡½æ•°
Generatorå‡½æ•°è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œyieldå‘½ä»¤ç»™å‡ºæ¯ä¸€æ­¥çš„è¿”å›å€¼ï¼Œæ˜¯Symbol.iteratoræ–¹æ³•çš„æœ€ç®€å•å®ç°ã€‚
```js
const obj = {
    [Symbol.iterator]: function* () {
        yield 1;
        yield 2;
        yield 3;
    }
};
// æˆ–è€…ç®€å†™æˆä¸‹é¢çš„å½¢å¼
const obj = {
    * [Symbol.iterator]() {
        yield 1;
        yield 2;
        yield 33;
    }
};

console.log([...obj]); // [ 1, 2, 3 ]
```
## éå†å™¨å¯¹è±¡çš„returnå’Œthrowæ–¹æ³•
```js
const arr = [1, 2, 3];
for (let i of arr) {
    console.log(i); // åªä¼šè¾“å‡º1
    break;
}
```
returnæ–¹æ³•(å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡)çš„ä½¿ç”¨åœºåˆæ˜¯ï¼šfor...ofå¾ªç¯æå‰é€€å‡ºï¼Œå°±ä¼šè°ƒç”¨returnæ–¹æ³•ã€‚for...ofå¾ªç¯æå‰é€€å‡ºçš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼š
* ä»£ç å‡ºé”™
* ä½¿ç”¨äº†breakè¯­å¥

throwæ–¹æ³•ä¸»è¦æ˜¯é…åˆ Generatorå‡½æ•°ä½¿ç”¨ï¼Œä¸€èˆ¬çš„éå†å™¨å¯¹è±¡ç”¨ä¸åˆ°è¿™ä¸ªæ–¹æ³•ã€‚
## for...of
1. éå†æ•°ç»„
2. éå†Set
3. éå†Map
4. éå†å­—ç¬¦ä¸²
5. éå†ä¼ªæ•°ç»„

`for...of`å¾ªç¯ä¸èƒ½ç›´æ¥éå†å¯¹è±¡ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢ä¸¤ç§æ–¹æ³•ï¼š
```js
const obj = {
    name: 'lisi',
    age: 12
};

for (let key of Object.keys(obj)) {
    console.log(key, obj[key]);
}
```
```js
const obj = {
    name: 'lisi',
    age: 12
};

// ä½¿ç”¨Generatorå‡½æ•°å°†å¯¹è±¡é‡æ–°åŒ…è£…ä¸€ä¸‹
function* entries(obj) {
    for (let key of Object.keys(obj)) {
        yield [key, obj[key]];
    }
}

for (let [key, value] of entries(obj)) {
    console.log(key, value);
}
```
### ä¸å…¶ä»–éå†è¯­æ³•çš„æ¯”è¾ƒ
ä»¥æ•°ç»„ä¸ºä¾‹ï¼Œjsæä¾›å¤šç§éå†è¯­æ³•ã€‚æœ€åŸå§‹çš„å†™æ³•å°±æ˜¯forå¾ªç¯ã€‚
```js
for (var index = 0; index < myArray.length; index++) {
  console.log(myArray[index]);
}
```
è¿™ç§å†™æ³•æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤æ•°ç»„æä¾›å†…ç½®çš„forEachæ–¹æ³•ã€‚
```js
arr.forEach(value => {
  console.log(value);
});
```
forEachçš„é—®é¢˜åœ¨äºï¼šæ— æ³•ä¸­é€”è·³å‡ºforEachå¾ªç¯ï¼Œbreakå‘½ä»¤æˆ–returnå‘½ä»¤éƒ½ä¸ç”Ÿæ•ˆã€‚

for...inå¾ªç¯å¯ä»¥éå†æ•°ç»„çš„é”®åã€‚
```js
for (var index in myArray) {
  console.log(myArray[index]);
}
```
for...inå¾ªç¯æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š

* æ•°ç»„çš„é”®åæ˜¯æ•°å­—ï¼Œä½†æ˜¯for...inå¾ªç¯æ˜¯ä»¥å­—ç¬¦ä¸²ä½œä¸ºé”®å'0'ã€'1'ã€'2'ã€‚
* for...inå¾ªç¯ä¸ä»…éå†æ•°å­—é”®åï¼Œè¿˜ä¼šéå†æ‰‹åŠ¨æ·»åŠ çš„å…¶ä»–é”®ï¼Œç”šè‡³åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„é”®ã€‚
* æŸäº›æƒ…å†µä¸‹ï¼Œfor...inå¾ªç¯ä¼šä»¥ä»»æ„é¡ºåºéå†é”®åã€‚

æ€»ä¹‹ï¼Œ**for...inå¾ªç¯ä¸»è¦æ˜¯ä¸ºéå†å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œä¸é€‚ç”¨äºéå†æ•°ç»„**ã€‚

```js
for (let value of myArray) {
  console.log(value);
}
```
for...ofå¾ªç¯ç›¸æ¯”ä¸Šé¢å‡ ç§åšæ³•ï¼Œæœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜ç‚¹ï¼š
* å’Œ`for...in`ä¸€æ ·çš„ç®€æ´è¯­æ³•ï¼Œä½†æ˜¯æ²¡æœ‰`for...in`é‚£äº›ç¼ºç‚¹ã€‚
* ä¸åŒäºforEachæ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¸breakã€continueå’Œreturné…åˆä½¿ç”¨ã€‚
* æä¾›äº†éå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ“ä½œæ¥å£ã€‚
